{"version":3,"file":"company_capabilities.min.js","sources":["../src/company_capabilities.js"],"sourcesContent":["/*\r\n * @package    block_iomad_company_admin\r\n * @copyright  2019 Howard Miller\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n /**\r\n  * @module block_iomad_company_admin/company_capabilities\r\n  */\r\n\r\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/modal_factory', 'core/modal_events', 'core/str'],\r\n    function($, ajax, notification, ModalFactory, ModalEvents, str) {\r\n    return {\r\n        init: function(companyid, templateid, roleid) {\r\n\r\n            // Set/unset capability checkbox\r\n            $(\".capabilities-checkbox\").on('change', function() {\r\n                var capability = $(this).data(\"capability\");\r\n                var checked = $(this).prop('checked');\r\n                ajax.call([{\r\n                    methodname : 'block_iomad_company_admin_restrict_capability',\r\n                    args : {\r\n                        capability : capability,\r\n                        roleid : roleid,\r\n                        companyid : companyid,\r\n                        allow : checked,\r\n                        templateid: templateid\r\n                    },\r\n                    fail: notification.exception\r\n                }]);\r\n            });\r\n\r\n            // Template delete button.\r\n            // Note - have to manually show modal as modal events don't save the original\r\n            // clicked link :(\r\n            $('a.template-delete').on('click', function(e) {\r\n                var clickedLink = $(e.currentTarget);\r\n                var strings = [\r\n                    {\r\n                        key: 'deleteroletemplatefull',\r\n                        component: 'block_iomad_company_admin'\r\n                    },\r\n                    {\r\n                        key: 'deleteroletemplate',\r\n                        component: 'block_iomad_company_admin'\r\n                    },\r\n                    {\r\n                        key: 'delete'\r\n                    }\r\n                ];\r\n                str.get_strings(strings).then(function(strresults) {\r\n                    ModalFactory.create({\r\n                        type: ModalFactory.types.SAVE_CANCEL,\r\n                        title: strresults[1] + '  \"<b>' + clickedLink.data('name') + '</b>\"',\r\n                        body: strresults[0],\r\n                        })\r\n                        .then(function(modal) {\r\n                            modal.setSaveButtonText(strresults[2]);\r\n                            var root = modal.getRoot();\r\n                            root.on(ModalEvents.save, function() {\r\n                                var templateid = clickedLink.data('templateid');\r\n                                ajax.call([{\r\n                                    methodname: 'block_iomad_company_admin_capability_delete_template',\r\n                                    args : {\r\n                                        templateid: templateid\r\n                                    },\r\n                                    done: function() {\r\n                                        location.reload();\r\n                                    },\r\n                                    fail: notification.exception\r\n                                }]);\r\n                            });\r\n                            modal.show();\r\n                        });\r\n                    });\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","ajax","notification","ModalFactory","ModalEvents","str","init","companyid","templateid","roleid","on","capability","this","data","checked","prop","call","methodname","args","allow","fail","exception","e","clickedLink","currentTarget","get_strings","key","component","then","strresults","create","type","types","SAVE_CANCEL","title","body","modal","setSaveButtonText","getRoot","save","done","location","reload","show"],"mappings":";;;;;AAUAA,wDAAO,CAAC,SAAU,YAAa,oBAAqB,qBAAsB,oBAAqB,aAC3F,SAASC,EAAGC,KAAMC,aAAcC,aAAcC,YAAaC,WACpD,CACHC,KAAM,SAASC,UAAWC,WAAYC,QAGlCT,EAAE,0BAA0BU,GAAG,UAAU,eACjCC,WAAaX,EAAEY,MAAMC,KAAK,cAC1BC,QAAUd,EAAEY,MAAMG,KAAK,WAC3Bd,KAAKe,KAAK,CAAC,CACPC,WAAa,gDACbC,KAAO,CACHP,WAAaA,WACbF,OAASA,OACTF,UAAYA,UACZY,MAAQL,QACRN,WAAYA,YAEhBY,KAAMlB,aAAamB,gBAO3BrB,EAAE,qBAAqBU,GAAG,SAAS,SAASY,OACpCC,YAAcvB,EAAEsB,EAAEE,eActBnB,IAAIoB,YAbU,CACV,CACIC,IAAK,yBACLC,UAAW,6BAEf,CACID,IAAK,qBACLC,UAAW,6BAEf,CACID,IAAK,YAGYE,MAAK,SAASC,YACnC1B,aAAa2B,OAAO,CAChBC,KAAM5B,aAAa6B,MAAMC,YACzBC,MAAOL,WAAW,GAAK,SAAWN,YAAYV,KAAK,QAAU,QAC7DsB,KAAMN,WAAW,KAEhBD,MAAK,SAASQ,OACXA,MAAMC,kBAAkBR,WAAW,IACxBO,MAAME,UACZ5B,GAAGN,YAAYmC,MAAM,eAClB/B,WAAae,YAAYV,KAAK,cAClCZ,KAAKe,KAAK,CAAC,CACPC,WAAY,uDACZC,KAAO,CACHV,WAAYA,YAEhBgC,KAAM,WACFC,SAASC,UAEbtB,KAAMlB,aAAamB,gBAG3Be,MAAMO"}