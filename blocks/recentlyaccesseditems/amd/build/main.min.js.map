{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["\r\n// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript to initialise the Recently accessed items block.\r\n *\r\n * @module     block_recentlyaccesseditems/main\r\n * @copyright  2018 Victor Deniz <victor@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'block_recentlyaccesseditems/repository',\r\n        'core/templates',\r\n        'core/notification'\r\n    ],\r\n    function(\r\n        $,\r\n        Repository,\r\n        Templates,\r\n        Notification\r\n    ) {\r\n\r\n        var NUM_ITEMS = 9;\r\n        // Maximum number of elements to display in the block initially.\r\n        var NUM_ITEMS_INIT = 3;\r\n\r\n        var SELECTORS = {\r\n            CARDDECK_CONTAINER: '[data-region=\"recentlyaccesseditems-view\"]',\r\n            CARDDECK: '[data-region=\"recentlyaccesseditems-view-content\"]',\r\n            SHOWMORE_LINK: '[data-region=\"recentlyaccesseditems-view\"] [data-action=\"more-items\"]',\r\n        };\r\n\r\n        /**\r\n         * Register event listeners.\r\n         */\r\n        const registerEventListeners = () => {\r\n            const showmoreLink = document.querySelector(SELECTORS.SHOWMORE_LINK);\r\n\r\n            // Hide \"Show more\" link and show additional items.\r\n            showmoreLink.addEventListener('click', () => {\r\n                showmoreLink.classList.add('d-none');\r\n\r\n                const hiddenItems = document.querySelector('[data-region=\"items-list\"]').children;\r\n                for (const hiddenItem of hiddenItems) {\r\n                    hiddenItem.style = \"display: block\";\r\n                }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Get recent items from backend.\r\n         *\r\n         * @method getRecentItems\r\n         * @param {int} limit Only return this many results\r\n         * @return {array} Items user most recently has accessed\r\n         */\r\n        var getRecentItems = function(limit) {\r\n            return Repository.getRecentItems(limit);\r\n        };\r\n\r\n        /**\r\n         * Render the block content.\r\n         *\r\n         * @method renderItems\r\n         * @param {object} root The root element for the items view.\r\n         * @param {array} items containing array of returned items.\r\n         * @return {promise} Resolved with HTML and JS strings\r\n         */\r\n        var renderItems = function(root, items) {\r\n            if (items.length > 0) {\r\n                let hasmoreitems = false;\r\n                if (items.length > NUM_ITEMS_INIT) {\r\n                    hasmoreitems = true;\r\n                }\r\n                return Templates.render('block_recentlyaccesseditems/view-cards', {\r\n                    items: items,\r\n                    hasmoreitems: hasmoreitems\r\n                });\r\n            } else {\r\n                var noitemsimgurl = root.attr('data-noitemsimgurl');\r\n                return Templates.render('block_recentlyaccesseditems/no-items', {\r\n                    noitemsimgurl: noitemsimgurl\r\n                });\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Get and show the recent items into the block.\r\n         *\r\n         * @param {object} root The root element for the items block.\r\n         */\r\n        var init = function(root) {\r\n            root = $(root);\r\n\r\n            var itemsContainer = root.find(SELECTORS.CARDDECK_CONTAINER);\r\n            var itemsContent = root.find(SELECTORS.CARDDECK);\r\n\r\n            var itemsPromise = getRecentItems(NUM_ITEMS);\r\n\r\n            itemsPromise.then(function(items) {\r\n                var pageContentPromise = renderItems(itemsContainer, items);\r\n\r\n                pageContentPromise.then(function(html, js) {\r\n                    Templates.replaceNodeContents(itemsContent, html, js);\r\n                    if (items.length > 3) {\r\n                        registerEventListeners();\r\n                    }\r\n                    return null;\r\n                }).catch(Notification.exception);\r\n            }).catch(Notification.exception);\r\n        };\r\n\r\n        return {\r\n            init: init\r\n        };\r\n    });"],"names":["define","$","Repository","Templates","Notification","SELECTORS","init","root","limit","itemsContainer","find","itemsContent","getRecentItems","then","items","pageContentPromise","length","hasmoreitems","render","noitemsimgurl","attr","renderItems","html","js","replaceNodeContents","showmoreLink","document","querySelector","addEventListener","classList","add","hiddenItems","children","hiddenItem","style","registerEventListeners","catch","exception"],"mappings":";;;;;;;AAwBAA,0CACI,CACI,SACA,yCACA,iBACA,sBAEJ,SACIC,EACAC,WACAC,UACAC,kBAOIC,6BACoB,6CADpBA,mBAEU,qDAFVA,wBAGe,8EAmFZ,CACHC,KAtBO,SAASC,UAnCUC,MAsCtBC,gBAFJF,KAAON,EAAEM,OAEiBG,KAAKL,8BAC3BM,aAAeJ,KAAKG,KAAKL,qBAvCHG,MAlCd,EAmCLN,WAAWU,eAAeJ,QA0CpBK,MAAK,SAASC,WACnBC,mBAhCM,SAASR,KAAMO,UACzBA,MAAME,OAAS,EAAG,KACdC,cAAe,SACfH,MAAME,OA/CG,IAgDTC,cAAe,GAEZd,UAAUe,OAAO,yCAA0C,CAC9DJ,MAAOA,MACPG,aAAcA,mBAGdE,cAAgBZ,KAAKa,KAAK,6BACvBjB,UAAUe,OAAO,uCAAwC,CAC5DC,cAAeA,gBAmBME,CAAYZ,eAAgBK,OAErDC,mBAAmBF,MAAK,SAASS,KAAMC,WACnCpB,UAAUqB,oBAAoBb,aAAcW,KAAMC,IAC9CT,MAAME,OAAS,GArEA,YACrBS,aAAeC,SAASC,cAActB,yBAG5CoB,aAAaG,iBAAiB,SAAS,KACnCH,aAAaI,UAAUC,IAAI,gBAErBC,YAAcL,SAASC,cAAc,8BAA8BK,aACpE,MAAMC,cAAcF,YACrBE,WAAWC,MAAQ,qBA6DfC,GAEG,QACRC,MAAMhC,aAAaiC,cACvBD,MAAMhC,aAAaiC"}