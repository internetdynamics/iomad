{"version":3,"file":"grading_actions.min.js","sources":["../src/grading_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\r\n *\r\n * @module     mod_assign/grading_actions\r\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.1\r\n */\r\ndefine(['jquery', 'mod_assign/grading_events'], function($, GradingEvents) {\r\n\r\n    /**\r\n     * GradingActions class.\r\n     *\r\n     * @class mod_assign/grading_actions\r\n     * @param {String} selector The selector for the page region containing the actions panel.\r\n     */\r\n    var GradingActions = function(selector) {\r\n        this._regionSelector = selector;\r\n        this._region = $(selector);\r\n\r\n        this.registerEventListeners();\r\n    };\r\n\r\n    /** @property {String} Selector for the page region containing the user navigation. */\r\n    GradingActions.prototype._regionSelector = null;\r\n\r\n    /** @property {Integer} Remember the last user id to prevent unnessecary reloads. */\r\n    GradingActions.prototype._lastUserId = 0;\r\n\r\n    /** @property {JQuery} JQuery node for the page region containing the user navigation. */\r\n    GradingActions.prototype._region = null;\r\n\r\n    /**\r\n     * Show the actions if there is valid user.\r\n     *\r\n     * @method _showActionsForm\r\n     * @private\r\n     * @param {Event} event\r\n     * @param {Integer} userid\r\n     */\r\n    GradingActions.prototype._showActionsForm = function(event, userid) {\r\n        var form = this._region.find('[data-region=grading-actions-form]');\r\n\r\n        if (userid != this._lastUserId && userid > 0) {\r\n            this._lastUserId = userid;\r\n        }\r\n        if (userid > 0) {\r\n            form.removeClass('hide');\r\n        } else {\r\n            form.addClass('hide');\r\n        }\r\n\r\n    };\r\n\r\n    /**\r\n     * Trigger the named action.\r\n     *\r\n     * @method _trigger\r\n     * @private\r\n     * @param {String} action\r\n     */\r\n    GradingActions.prototype._trigger = function(action) {\r\n        $(document).trigger(action);\r\n    };\r\n\r\n    /**\r\n     * Get the review panel element.\r\n     *\r\n     * @method getReviewPanelElement\r\n     * @return {jQuery}\r\n     */\r\n    GradingActions.prototype.getReviewPanelElement = function() {\r\n        return $('[data-region=\"review-panel\"]');\r\n    };\r\n\r\n    /**\r\n     * Check if the page has a review panel.\r\n     *\r\n     * @method hasReviewPanelElement\r\n     * @return {bool}\r\n     */\r\n    GradingActions.prototype.hasReviewPanelElement = function() {\r\n        return this.getReviewPanelElement().length > 0;\r\n    };\r\n\r\n    /**\r\n     * Get the collapse grade panel button.\r\n     *\r\n     * @method getCollapseGradePanelButton\r\n     * @return {jQuery}\r\n     */\r\n    GradingActions.prototype.getCollapseGradePanelButton = function() {\r\n        return $('[data-region=\"grade-actions\"] .collapse-grade-panel');\r\n    };\r\n\r\n    /**\r\n     * Get the collapse review panel button.\r\n     *\r\n     * @method getCollapseReviewPanelButton\r\n     * @return {jQuery}\r\n     */\r\n    GradingActions.prototype.getCollapseReviewPanelButton = function() {\r\n        return $('[data-region=\"grade-actions\"] .collapse-review-panel');\r\n    };\r\n\r\n    /**\r\n     * Get the expand all panels button.\r\n     *\r\n     * @method getExpandAllPanelsButton\r\n     * @return {jQuery}\r\n     */\r\n    GradingActions.prototype.getExpandAllPanelsButton = function() {\r\n        return $('[data-region=\"grade-actions\"] .collapse-none');\r\n    };\r\n\r\n    /**\r\n     * Remove the active state from all layout buttons.\r\n     *\r\n     * @method resetLayoutButtons\r\n     */\r\n    GradingActions.prototype.resetLayoutButtons = function() {\r\n        this.getCollapseGradePanelButton().removeClass('active');\r\n        this.getCollapseReviewPanelButton().removeClass('active');\r\n        this.getExpandAllPanelsButton().removeClass('active');\r\n    };\r\n\r\n    /**\r\n     * Hide the review panel.\r\n     *\r\n     * @method collapseReviewPanel\r\n     */\r\n    GradingActions.prototype.collapseReviewPanel = function() {\r\n        $(document).trigger(GradingEvents.COLLAPSE_REVIEW_PANEL);\r\n        $(document).trigger(GradingEvents.EXPAND_GRADE_PANEL);\r\n        this.resetLayoutButtons();\r\n        this.getCollapseReviewPanelButton().addClass('active');\r\n    };\r\n\r\n    /**\r\n     * Show/Hide the grade panel.\r\n     *\r\n     * @method collapseGradePanel\r\n     */\r\n    GradingActions.prototype.collapseGradePanel = function() {\r\n        $(document).trigger(GradingEvents.COLLAPSE_GRADE_PANEL);\r\n        $(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL);\r\n        this.resetLayoutButtons();\r\n        this.getCollapseGradePanelButton().addClass('active');\r\n    };\r\n\r\n    /**\r\n     * Return the layout to default.\r\n     *\r\n     * @method expandAllPanels\r\n     */\r\n    GradingActions.prototype.expandAllPanels = function() {\r\n        $(document).trigger(GradingEvents.EXPAND_GRADE_PANEL);\r\n        $(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL);\r\n        this.resetLayoutButtons();\r\n        this.getExpandAllPanelsButton().addClass('active');\r\n    };\r\n\r\n    /**\r\n     * Register event listeners for the grade panel.\r\n     *\r\n     * @method registerEventListeners\r\n     */\r\n    GradingActions.prototype.registerEventListeners = function() {\r\n        // Don't need layout controls if there is no review panel.\r\n        if (this.hasReviewPanelElement()) {\r\n            var collapseReviewPanelButton = this.getCollapseReviewPanelButton();\r\n            collapseReviewPanelButton.click(function(e) {\r\n                this.collapseReviewPanel();\r\n                e.preventDefault();\r\n            }.bind(this));\r\n\r\n            collapseReviewPanelButton.keydown(function(e) {\r\n                if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                    if (e.keyCode === 13 || e.keyCode === 32) {\r\n                        this.collapseReviewPanel();\r\n                        e.preventDefault();\r\n                    }\r\n                }\r\n            }.bind(this));\r\n\r\n            var collapseGradePanelButton = this.getCollapseGradePanelButton();\r\n            collapseGradePanelButton.click(function(e) {\r\n                this.collapseGradePanel();\r\n                e.preventDefault();\r\n            }.bind(this));\r\n\r\n            collapseGradePanelButton.keydown(function(e) {\r\n                if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                    if (e.keyCode === 13 || e.keyCode === 32) {\r\n                        this.collapseGradePanel();\r\n                        e.preventDefault();\r\n                    }\r\n                }\r\n            }.bind(this));\r\n\r\n            var expandAllPanelsButton = this.getExpandAllPanelsButton();\r\n            expandAllPanelsButton.click(function(e) {\r\n                this.expandAllPanels();\r\n                e.preventDefault();\r\n            }.bind(this));\r\n\r\n            expandAllPanelsButton.keydown(function(e) {\r\n                if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                    if (e.keyCode === 13 || e.keyCode === 32) {\r\n                        this.expandAllPanels();\r\n                        e.preventDefault();\r\n                    }\r\n                }\r\n            }.bind(this));\r\n        }\r\n\r\n        $(document).on('user-changed', this._showActionsForm.bind(this));\r\n\r\n        this._region.find('[name=\"savechanges\"]').on('click', this._trigger.bind(this, 'save-changes'));\r\n        this._region.find('[name=\"saveandshownext\"]').on('click', this._trigger.bind(this, 'save-and-show-next'));\r\n        this._region.find('[name=\"resetbutton\"]').on('click', this._trigger.bind(this, 'reset'));\r\n        this._region.find('form').on('submit', function(e) {\r\n            e.preventDefault();\r\n        });\r\n    };\r\n\r\n    return GradingActions;\r\n});\r\n"],"names":["define","$","GradingEvents","GradingActions","selector","_regionSelector","_region","registerEventListeners","prototype","_lastUserId","_showActionsForm","event","userid","form","this","find","removeClass","addClass","_trigger","action","document","trigger","getReviewPanelElement","hasReviewPanelElement","length","getCollapseGradePanelButton","getCollapseReviewPanelButton","getExpandAllPanelsButton","resetLayoutButtons","collapseReviewPanel","COLLAPSE_REVIEW_PANEL","EXPAND_GRADE_PANEL","collapseGradePanel","COLLAPSE_GRADE_PANEL","EXPAND_REVIEW_PANEL","expandAllPanels","collapseReviewPanelButton","click","e","preventDefault","bind","keydown","metaKey","shiftKey","altKey","ctrlKey","keyCode","collapseGradePanelButton","expandAllPanelsButton","on"],"mappings":"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"}