{"version":3,"file":"grader.min.js","sources":["../../../src/local/grades/grader.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This module will tie together all of the different calls the gradable module will make.\r\n *\r\n * @module     mod_forum/local/grades/grader\r\n * @copyright  2019 Mathew May <mathew.solutions>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport Templates from 'core/templates';\r\nimport Selectors from './local/grader/selectors';\r\nimport getUserPicker from './local/grader/user_picker';\r\nimport {createLayout as createFullScreenWindow} from 'mod_forum/local/layout/fullscreen';\r\nimport getGradingPanelFunctions from './local/grader/gradingpanel';\r\nimport {add as addToast} from 'core/toast';\r\nimport {addNotification} from 'core/notification';\r\nimport {get_string as getString} from 'core/str';\r\nimport {failedUpdate} from 'core_grades/grades/grader/gradingpanel/normalise';\r\nimport {addIconToContainerWithPromise} from 'core/loadingicon';\r\nimport {debounce} from 'core/utils';\r\nimport {fillInitialValues} from 'core_grades/grades/grader/gradingpanel/comparison';\r\nimport * as Modal from 'core/modal_factory';\r\nimport * as ModalEvents from 'core/modal_events';\r\nimport {subscribe} from 'core/pubsub';\r\nimport DrawerEvents from 'core/drawer_events';\r\n\r\nconst templateNames = {\r\n    grader: {\r\n        app: 'mod_forum/local/grades/grader',\r\n        gradingPanel: {\r\n            error: 'mod_forum/local/grades/local/grader/gradingpanel/error',\r\n        },\r\n        searchResults: 'mod_forum/local/grades/local/grader/user_picker/user_search',\r\n        status: 'mod_forum/local/grades/local/grader/status',\r\n    },\r\n};\r\n\r\n/**\r\n * Helper function that replaces the user picker placeholder with what we get back from the user picker class.\r\n *\r\n * @param {HTMLElement} root\r\n * @param {String} html\r\n */\r\nconst displayUserPicker = (root, html) => {\r\n    const pickerRegion = root.querySelector(Selectors.regions.pickerRegion);\r\n    Templates.replaceNodeContents(pickerRegion, html, '');\r\n};\r\n\r\n/**\r\n * To be removed, this is now done as a part of Templates.renderForPromise()\r\n *\r\n * @param {String} html\r\n * @param {String} js\r\n * @returns {array} An array containing the HTML, and JS.\r\n */\r\nconst fetchContentFromRender = (html, js) => {\r\n    return [html, js];\r\n};\r\n\r\n/**\r\n * Here we build the function that is passed to the user picker that'll handle updating the user content area\r\n * of the grading interface.\r\n *\r\n * @param {HTMLElement} root\r\n * @param {Function} getContentForUser\r\n * @param {Function} getGradeForUser\r\n * @param {Function} saveGradeForUser\r\n * @return {Function}\r\n */\r\nconst getUpdateUserContentFunction = (root, getContentForUser, getGradeForUser, saveGradeForUser) => {\r\n    let firstLoad = true;\r\n\r\n    return async(user) => {\r\n        const spinner = firstLoad ? null : addIconToContainerWithPromise(root);\r\n        const [\r\n            [html, js],\r\n            userGrade,\r\n        ] = await Promise.all([\r\n            getContentForUser(user.id).then(fetchContentFromRender),\r\n            getGradeForUser(user.id),\r\n        ]);\r\n        Templates.replaceNodeContents(root.querySelector(Selectors.regions.moduleReplace), html, js);\r\n\r\n        const [\r\n            gradingPanelHtml,\r\n            gradingPanelJS\r\n        ] = await Templates.render(userGrade.templatename, userGrade.grade).then(fetchContentFromRender);\r\n        const panelContainer = root.querySelector(Selectors.regions.gradingPanelContainer);\r\n        const panel = panelContainer.querySelector(Selectors.regions.gradingPanel);\r\n        Templates.replaceNodeContents(panel, gradingPanelHtml, gradingPanelJS);\r\n\r\n        const form = panel.querySelector('form');\r\n        fillInitialValues(form);\r\n\r\n        form.addEventListener('submit', event => {\r\n            saveGradeForUser(user);\r\n            event.preventDefault();\r\n        });\r\n\r\n        panelContainer.scrollTop = 0;\r\n        firstLoad = false;\r\n\r\n        if (spinner) {\r\n            spinner.resolve();\r\n        }\r\n        return userGrade;\r\n    };\r\n};\r\n\r\n/**\r\n * Show the search results container and hide the user picker and body content.\r\n *\r\n * @param {HTMLElement} bodyContainer The container element for the body content\r\n * @param {HTMLElement} userPickerContainer The container element for the user picker\r\n * @param {HTMLElement} searchResultsContainer The container element for the search results\r\n */\r\nconst showSearchResultContainer = (bodyContainer, userPickerContainer, searchResultsContainer) => {\r\n    bodyContainer.classList.add('hidden');\r\n    userPickerContainer.classList.add('hidden');\r\n    searchResultsContainer.classList.remove('hidden');\r\n};\r\n\r\n/**\r\n * Hide the search results container and show the user picker and body content.\r\n *\r\n * @param {HTMLElement} bodyContainer The container element for the body content\r\n * @param {HTMLElement} userPickerContainer The container element for the user picker\r\n * @param {HTMLElement} searchResultsContainer The container element for the search results\r\n */\r\nconst hideSearchResultContainer = (bodyContainer, userPickerContainer, searchResultsContainer) => {\r\n    bodyContainer.classList.remove('hidden');\r\n    userPickerContainer.classList.remove('hidden');\r\n    searchResultsContainer.classList.add('hidden');\r\n};\r\n\r\n/**\r\n * Toggles the visibility of the user search.\r\n *\r\n * @param {HTMLElement} toggleSearchButton The button that toggles the search\r\n * @param {HTMLElement} searchContainer The container element for the user search\r\n * @param {HTMLElement} searchInput The input element for searching\r\n */\r\nconst showUserSearchInput = (toggleSearchButton, searchContainer, searchInput) => {\r\n    searchContainer.classList.remove('collapsed');\r\n    toggleSearchButton.setAttribute('aria-expanded', 'true');\r\n    toggleSearchButton.classList.add('expand');\r\n    toggleSearchButton.classList.remove('collapse');\r\n\r\n    // Hide the grading info container from screen reader.\r\n    const gradingInfoContainer = searchContainer.parentElement.querySelector(Selectors.regions.gradingInfoContainer);\r\n    gradingInfoContainer.setAttribute('aria-hidden', 'true');\r\n\r\n    // Hide the collapse grading drawer button from screen reader.\r\n    const collapseGradingDrawer = searchContainer.parentElement.querySelector(Selectors.buttons.collapseGradingDrawer);\r\n    collapseGradingDrawer.setAttribute('aria-hidden', 'true');\r\n    collapseGradingDrawer.setAttribute('tabindex', '-1');\r\n\r\n    searchInput.focus();\r\n};\r\n\r\n/**\r\n * Toggles the visibility of the user search.\r\n *\r\n * @param {HTMLElement} toggleSearchButton The button that toggles the search\r\n * @param {HTMLElement} searchContainer The container element for the user search\r\n * @param {HTMLElement} searchInput The input element for searching\r\n */\r\nconst hideUserSearchInput = (toggleSearchButton, searchContainer, searchInput) => {\r\n    searchContainer.classList.add('collapsed');\r\n    toggleSearchButton.setAttribute('aria-expanded', 'false');\r\n    toggleSearchButton.classList.add('collapse');\r\n    toggleSearchButton.classList.remove('expand');\r\n    toggleSearchButton.focus();\r\n\r\n    // Show the grading info container to screen reader.\r\n    const gradingInfoContainer = searchContainer.parentElement.querySelector(Selectors.regions.gradingInfoContainer);\r\n    gradingInfoContainer.removeAttribute('aria-hidden');\r\n\r\n    // Show the collapse grading drawer button from screen reader.\r\n    const collapseGradingDrawer = searchContainer.parentElement.querySelector(Selectors.buttons.collapseGradingDrawer);\r\n    collapseGradingDrawer.removeAttribute('aria-hidden');\r\n    collapseGradingDrawer.setAttribute('tabindex', '0');\r\n\r\n    searchInput.value = '';\r\n};\r\n\r\n/**\r\n * Find the list of users who's names include the given search term.\r\n *\r\n * @param {Array} userList List of users for the grader\r\n * @param {String} searchTerm The search term to match\r\n * @return {Array}\r\n */\r\nconst searchForUsers = (userList, searchTerm) => {\r\n    if (searchTerm === '') {\r\n        return userList;\r\n    }\r\n\r\n    searchTerm = searchTerm.toLowerCase();\r\n\r\n    return userList.filter((user) => {\r\n        return user.fullname.toLowerCase().includes(searchTerm);\r\n    });\r\n};\r\n\r\n/**\r\n * Render the list of users in the search results area.\r\n *\r\n * @param {HTMLElement} searchResultsContainer The container element for search results\r\n * @param {Array} users The list of users to display\r\n */\r\nconst renderSearchResults = async(searchResultsContainer, users) => {\r\n    const {html, js} = await Templates.renderForPromise(templateNames.grader.searchResults, {users});\r\n    Templates.replaceNodeContents(searchResultsContainer, html, js);\r\n};\r\n\r\n/**\r\n * Add click handlers to the buttons in the header of the grading interface.\r\n *\r\n * @param {HTMLElement} graderLayout\r\n * @param {Object} userPicker\r\n * @param {Function} saveGradeFunction\r\n * @param {Array} userList List of users for the grader.\r\n */\r\nconst registerEventListeners = (graderLayout, userPicker, saveGradeFunction, userList) => {\r\n    const graderContainer = graderLayout.getContainer();\r\n    const toggleSearchButton = graderContainer.querySelector(Selectors.buttons.toggleSearch);\r\n    const searchInputContainer = graderContainer.querySelector(Selectors.regions.userSearchContainer);\r\n    const searchInput = searchInputContainer.querySelector(Selectors.regions.userSearchInput);\r\n    const bodyContainer = graderContainer.querySelector(Selectors.regions.bodyContainer);\r\n    const userPickerContainer = graderContainer.querySelector(Selectors.regions.pickerRegion);\r\n    const searchResultsContainer = graderContainer.querySelector(Selectors.regions.searchResultsContainer);\r\n\r\n    graderContainer.addEventListener('click', (e) => {\r\n        if (e.target.closest(Selectors.buttons.toggleFullscreen)) {\r\n            e.stopImmediatePropagation();\r\n            e.preventDefault();\r\n            graderLayout.toggleFullscreen();\r\n\r\n            return;\r\n        }\r\n\r\n        if (e.target.closest(Selectors.buttons.closeGrader)) {\r\n            e.stopImmediatePropagation();\r\n            e.preventDefault();\r\n\r\n            graderLayout.close();\r\n\r\n            return;\r\n        }\r\n\r\n        if (e.target.closest(Selectors.buttons.saveGrade)) {\r\n            saveGradeFunction(userPicker.currentUser);\r\n        }\r\n\r\n        if (e.target.closest(Selectors.buttons.toggleSearch)) {\r\n            if (toggleSearchButton.getAttribute('aria-expanded') === 'true') {\r\n                // Search is open so let's close it.\r\n                hideUserSearchInput(toggleSearchButton, searchInputContainer, searchInput);\r\n                hideSearchResultContainer(bodyContainer, userPickerContainer, searchResultsContainer);\r\n                searchResultsContainer.innerHTML = '';\r\n            } else {\r\n                // Search is closed so let's open it.\r\n                showUserSearchInput(toggleSearchButton, searchInputContainer, searchInput);\r\n                showSearchResultContainer(bodyContainer, userPickerContainer, searchResultsContainer);\r\n                renderSearchResults(searchResultsContainer, userList);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        const selectUserButton = e.target.closest(Selectors.buttons.selectUser);\r\n        if (selectUserButton) {\r\n            const userId = selectUserButton.getAttribute('data-userid');\r\n            const user = userList.find(user => user.id == userId);\r\n            userPicker.setUserId(userId);\r\n            userPicker.showUser(user);\r\n            hideUserSearchInput(toggleSearchButton, searchInputContainer, searchInput);\r\n            hideSearchResultContainer(bodyContainer, userPickerContainer, searchResultsContainer);\r\n            searchResultsContainer.innerHTML = '';\r\n        }\r\n    });\r\n\r\n    // Debounce the search input so that it only executes 300 milliseconds after the user has finished typing.\r\n    searchInput.addEventListener('input', debounce(() => {\r\n        const users = searchForUsers(userList, searchInput.value);\r\n        renderSearchResults(searchResultsContainer, users);\r\n    }, 300));\r\n\r\n    // Remove the right margin of the content container when the grading panel is hidden so that it expands to full-width.\r\n    subscribe(DrawerEvents.DRAWER_HIDDEN, (drawerRoot) => {\r\n        const gradingPanel = drawerRoot[0];\r\n        if (gradingPanel.querySelector(Selectors.regions.gradingPanel)) {\r\n            setContentContainerMargin(graderContainer, 0);\r\n        }\r\n    });\r\n\r\n    // Bring back the right margin of the content container when the grading panel is shown to give space for the grading panel.\r\n    subscribe(DrawerEvents.DRAWER_SHOWN, (drawerRoot) => {\r\n        const gradingPanel = drawerRoot[0];\r\n        if (gradingPanel.querySelector(Selectors.regions.gradingPanel)) {\r\n            setContentContainerMargin(graderContainer, gradingPanel.offsetWidth);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Adjusts the right margin of the content container.\r\n *\r\n * @param {HTMLElement} graderContainer The container for the grader app.\r\n * @param {Number} rightMargin The right margin value.\r\n */\r\nconst setContentContainerMargin = (graderContainer, rightMargin) => {\r\n    const contentContainer = graderContainer.querySelector(Selectors.regions.moduleContainer);\r\n    if (contentContainer) {\r\n        contentContainer.style.marginRight = `${rightMargin}px`;\r\n    }\r\n};\r\n\r\n/**\r\n * Get the function used to save a user grade.\r\n *\r\n * @param {HTMLElement} root The container for the grader\r\n * @param {Function} setGradeForUser The function that will be called.\r\n * @return {Function}\r\n */\r\nconst getSaveUserGradeFunction = (root, setGradeForUser) => {\r\n    return async(user) => {\r\n        try {\r\n            root.querySelector(Selectors.regions.gradingPanelErrors).innerHTML = '';\r\n            const result = await setGradeForUser(\r\n                user.id,\r\n                root.querySelector(Selectors.values.sendStudentNotifications).value,\r\n                root.querySelector(Selectors.regions.gradingPanel)\r\n            );\r\n            if (result.success) {\r\n                addToast(await getString('grades:gradesavedfor', 'mod_forum', user));\r\n            }\r\n            if (result.failed) {\r\n                displayGradingError(root, user, result.error);\r\n            }\r\n\r\n            return result;\r\n        } catch (err) {\r\n            displayGradingError(root, user, err);\r\n\r\n            return failedUpdate(err);\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * Display a grading error, typically from a failed save.\r\n *\r\n * @param {HTMLElement} root The container for the grader\r\n * @param {Object} user The user who was errored\r\n * @param {Object} err The details of the error\r\n */\r\nconst displayGradingError = async(root, user, err) => {\r\n    const [\r\n        {html, js},\r\n        errorString\r\n    ] = await Promise.all([\r\n        Templates.renderForPromise(templateNames.grader.gradingPanel.error, {error: err}),\r\n        await getString('grades:gradesavefailed', 'mod_forum', {error: err.message, ...user}),\r\n    ]);\r\n\r\n    Templates.replaceNodeContents(root.querySelector(Selectors.regions.gradingPanelErrors), html, js);\r\n    addToast(errorString, {type: 'warning'});\r\n};\r\n\r\n/**\r\n * Launch the grader interface with the specified parameters.\r\n *\r\n * @param {Function} getListOfUsers A function to get the list of users\r\n * @param {Function} getContentForUser A function to get the content for a specific user\r\n * @param {Function} getGradeForUser A function get the grade details for a specific user\r\n * @param {Function} setGradeForUser A function to set the grade for a specific user\r\n * @param {Object} preferences Preferences for the launch function\r\n * @param {Number} preferences.initialUserId\r\n * @param {string} preferences.moduleName\r\n * @param {string} preferences.courseName\r\n * @param {string} preferences.courseUrl\r\n * @param {boolean} preferences.sendStudentNotifications\r\n * @param {null|HTMLElement} preferences.focusOnClose\r\n */\r\nexport const launch = async(getListOfUsers, getContentForUser, getGradeForUser, setGradeForUser, {\r\n    initialUserId = null,\r\n    moduleName,\r\n    courseName,\r\n    courseUrl,\r\n    sendStudentNotifications,\r\n    focusOnClose = null,\r\n} = {}) => {\r\n\r\n    // We need all of these functions to be executed in series, if one step runs before another the interface\r\n    // will not work.\r\n\r\n    // We need this promise to resolve separately so that we can avoid loading the whole interface if there are no users.\r\n    const userList = await getListOfUsers();\r\n    if (!userList.length) {\r\n        addNotification({\r\n            message: await getString('nouserstograde', 'core_grades'),\r\n            type: \"error\",\r\n        });\r\n        return;\r\n    }\r\n\r\n    // Now that we have confirmed there are at least some users let's boot up the grader interface.\r\n    const [\r\n        graderLayout,\r\n        {html, js},\r\n    ] = await Promise.all([\r\n        createFullScreenWindow({\r\n            fullscreen: false,\r\n            showLoader: false,\r\n            focusOnClose,\r\n        }),\r\n        Templates.renderForPromise(templateNames.grader.app, {\r\n            moduleName,\r\n            courseName,\r\n            courseUrl,\r\n            drawer: {show: true},\r\n            defaultsendnotifications: sendStudentNotifications,\r\n        }),\r\n    ]);\r\n\r\n    const graderContainer = graderLayout.getContainer();\r\n\r\n    const saveGradeFunction = getSaveUserGradeFunction(graderContainer, setGradeForUser);\r\n\r\n    Templates.replaceNodeContents(graderContainer, html, js);\r\n    const updateUserContent = getUpdateUserContentFunction(graderContainer, getContentForUser, getGradeForUser, saveGradeFunction);\r\n\r\n    const userIds = userList.map(user => user.id);\r\n    const statusContainer = graderContainer.querySelector(Selectors.regions.statusContainer);\r\n    // Fetch the userpicker for display.\r\n    const userPicker = await getUserPicker(\r\n        userList,\r\n        async(user) => {\r\n            const userGrade = await updateUserContent(user);\r\n            const renderContext = {\r\n                status: userGrade.hasgrade,\r\n                index: userIds.indexOf(user.id) + 1,\r\n                total: userList.length\r\n            };\r\n            Templates.render(templateNames.grader.status, renderContext).then(html => {\r\n                statusContainer.innerHTML = html;\r\n                return html;\r\n            }).catch();\r\n        },\r\n        saveGradeFunction,\r\n        {\r\n            initialUserId,\r\n        },\r\n    );\r\n\r\n    // Register all event listeners.\r\n    registerEventListeners(graderLayout, userPicker, saveGradeFunction, userList);\r\n\r\n    // Display the newly created user picker.\r\n    displayUserPicker(graderContainer, userPicker.rootNode);\r\n};\r\n\r\n/**\r\n * Show the grade for a specific user.\r\n *\r\n * @param {Function} getGradeForUser A function get the grade details for a specific user\r\n * @param {Number} userid The ID of a specific user\r\n * @param {String} moduleName the name of the module\r\n * @param {object} param\r\n * @param {null|HTMLElement} param.focusOnClose\r\n */\r\nexport const view = async(getGradeForUser, userid, moduleName, {\r\n    focusOnClose = null,\r\n} = {}) => {\r\n\r\n    const [\r\n        userGrade,\r\n        modal,\r\n    ] = await Promise.all([\r\n        getGradeForUser(userid),\r\n        Modal.create({\r\n            title: moduleName,\r\n            large: true,\r\n            type: Modal.types.CANCEL\r\n        }),\r\n    ]);\r\n\r\n    const spinner = addIconToContainerWithPromise(modal.getRoot());\r\n\r\n    // Handle hidden event.\r\n    modal.getRoot().on(ModalEvents.hidden, function() {\r\n        // Destroy when hidden.\r\n        modal.destroy();\r\n        if (focusOnClose) {\r\n            try {\r\n                focusOnClose.focus();\r\n            } catch (e) {\r\n                // eslint-disable-line\r\n            }\r\n        }\r\n    });\r\n\r\n    modal.show();\r\n    const output = document.createElement('div');\r\n    const {html, js} = await Templates.renderForPromise('mod_forum/local/grades/view_grade', userGrade);\r\n    Templates.replaceNodeContents(output, html, js);\r\n\r\n    // Note: We do not use await here because it messes with the Modal transitions.\r\n    const [gradeHTML, gradeJS] = await renderGradeTemplate(userGrade);\r\n    const gradeReplace = output.querySelector('[data-region=\"grade-template\"]');\r\n    Templates.replaceNodeContents(gradeReplace, gradeHTML, gradeJS);\r\n    modal.setBody(output.outerHTML);\r\n    spinner.resolve();\r\n};\r\n\r\nconst renderGradeTemplate = async(userGrade) => {\r\n    const {html, js} = await Templates.renderForPromise(userGrade.templatename, userGrade.grade);\r\n    return [html, js];\r\n};\r\nexport {getGradingPanelFunctions};\r\n"],"names":["templateNames","app","gradingPanel","error","searchResults","status","displayUserPicker","root","html","pickerRegion","querySelector","Selectors","regions","replaceNodeContents","fetchContentFromRender","js","getUpdateUserContentFunction","getContentForUser","getGradeForUser","saveGradeForUser","firstLoad","async","spinner","userGrade","Promise","all","user","id","then","moduleReplace","gradingPanelHtml","gradingPanelJS","Templates","render","templatename","grade","panelContainer","gradingPanelContainer","panel","form","addEventListener","event","preventDefault","scrollTop","resolve","hideSearchResultContainer","bodyContainer","userPickerContainer","searchResultsContainer","classList","remove","add","hideUserSearchInput","toggleSearchButton","searchContainer","searchInput","setAttribute","focus","parentElement","gradingInfoContainer","removeAttribute","collapseGradingDrawer","buttons","value","renderSearchResults","users","renderForPromise","registerEventListeners","graderLayout","userPicker","saveGradeFunction","userList","graderContainer","getContainer","toggleSearch","searchInputContainer","userSearchContainer","userSearchInput","e","target","closest","toggleFullscreen","stopImmediatePropagation","closeGrader","close","saveGrade","currentUser","getAttribute","innerHTML","showUserSearchInput","showSearchResultContainer","selectUserButton","selectUser","userId","find","setUserId","showUser","searchTerm","toLowerCase","filter","fullname","includes","searchForUsers","DrawerEvents","DRAWER_HIDDEN","drawerRoot","setContentContainerMargin","DRAWER_SHOWN","offsetWidth","rightMargin","contentContainer","moduleContainer","style","marginRight","getSaveUserGradeFunction","setGradeForUser","gradingPanelErrors","result","values","sendStudentNotifications","success","failed","displayGradingError","err","errorString","message","type","getListOfUsers","initialUserId","moduleName","courseName","courseUrl","focusOnClose","length","fullscreen","showLoader","drawer","show","defaultsendnotifications","updateUserContent","userIds","map","statusContainer","renderContext","hasgrade","index","indexOf","total","catch","rootNode","userid","modal","Modal","create","title","large","types","CANCEL","getRoot","on","ModalEvents","hidden","destroy","output","document","createElement","gradeHTML","gradeJS","renderGradeTemplate","gradeReplace","setBody","outerHTML"],"mappings":"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"}