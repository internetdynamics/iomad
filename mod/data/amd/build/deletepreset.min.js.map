{"version":3,"file":"deletepreset.min.js","sources":["../src/deletepreset.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript module for deleting a database as a preset.\r\n *\r\n * @module      mod_data/deletepreset\r\n * @copyright   2022 Amaia Anabitarte <amaia@moodle.com>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Notification from 'core/notification';\r\nimport {prefetchStrings} from 'core/prefetch';\r\nimport {get_string as getString} from 'core/str';\r\nimport Ajax from 'core/ajax';\r\nimport Url from 'core/url';\r\n\r\nconst selectors = {\r\n    deletePresetButton: '[data-action=\"deletepreset\"]',\r\n};\r\n\r\n/**\r\n * Initialize module\r\n */\r\nexport const init = () => {\r\n    prefetchStrings('mod_data', [\r\n        'deleteconfirm',\r\n        'deletewarning',\r\n    ]);\r\n    prefetchStrings('core', [\r\n        'delete',\r\n    ]);\r\n\r\n    registerEventListeners();\r\n};\r\n\r\n/**\r\n * Register events for delete preset option in action menu.\r\n */\r\nconst registerEventListeners = () => {\r\n    document.addEventListener('click', (event) => {\r\n        const deleteOption = event.target.closest(selectors.deletePresetButton);\r\n        if (deleteOption) {\r\n            event.preventDefault();\r\n            deletePresetConfirm(deleteOption);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Show the confirmation modal to delete the preset.\r\n *\r\n * @param {HTMLElement} deleteOption the element to delete.\r\n */\r\nconst deletePresetConfirm = (deleteOption) => {\r\n    const presetName = deleteOption.getAttribute('data-presetname');\r\n    const dataId = deleteOption.getAttribute('data-dataid');\r\n\r\n    Notification.deleteCancelPromise(\r\n        getString('deleteconfirm', 'mod_data', presetName),\r\n        getString('deletewarning', 'mod_data'),\r\n    ).then(() => {\r\n        return deletePreset(dataId, presetName);\r\n    }).catch(() => {\r\n        return;\r\n    });\r\n};\r\n\r\n/**\r\n * Delete site user preset.\r\n *\r\n * @param {int} dataId The id of the current database activity.\r\n * @param {string} presetName The preset name to delete.\r\n * @return {promise} Resolved with the result and warnings of deleting a preset.\r\n */\r\nasync function deletePreset(dataId, presetName) {\r\n    var request = {\r\n        methodname: 'mod_data_delete_saved_preset',\r\n        args: {\r\n            dataid: dataId,\r\n            presetnames: {presetname: presetName},\r\n        }\r\n    };\r\n    try {\r\n        await Ajax.call([request])[0];\r\n        window.location.href = Url.relativeUrl(\r\n            'mod/data/preset.php',\r\n            {\r\n                d: dataId,\r\n            },\r\n            false\r\n        );\r\n    } catch (error) {\r\n        Notification.exception(error);\r\n    }\r\n}\r\n"],"names":["selectors","registerEventListeners","document","addEventListener","event","deleteOption","target","closest","preventDefault","deletePresetConfirm","presetName","getAttribute","dataId","deleteCancelPromise","then","request","methodname","args","dataid","presetnames","presetname","Ajax","call","window","location","href","Url","relativeUrl","d","error","exception","deletePreset","catch"],"mappings":";;;;;;;kNA6BMA,6BACkB,6CAMJ,mCACA,WAAY,CACxB,gBACA,gDAEY,OAAQ,CACpB,WAGJC,gCAMEA,uBAAyB,KAC3BC,SAASC,iBAAiB,SAAUC,cAC1BC,aAAeD,MAAME,OAAOC,QAAQP,8BACtCK,eACAD,MAAMI,iBACNC,oBAAoBJ,mBAU1BI,oBAAuBJ,qBACnBK,WAAaL,aAAaM,aAAa,mBACvCC,OAASP,aAAaM,aAAa,qCAE5BE,qBACT,mBAAU,gBAAiB,WAAYH,aACvC,mBAAU,gBAAiB,aAC7BI,MAAK,mBAciBF,OAAQF,gBAC5BK,QAAU,CACVC,WAAY,+BACZC,KAAM,CACFC,OAAQN,OACRO,YAAa,CAACC,WAAYV,wBAIxBW,cAAKC,KAAK,CAACP,UAAU,GAC3BQ,OAAOC,SAASC,KAAOC,aAAIC,YACvB,sBACA,CACIC,EAAGhB,SAEP,GAEN,MAAOiB,6BACQC,UAAUD,QA/BhBE,CAAanB,OAAQF,cAC7BsB,OAAM"}