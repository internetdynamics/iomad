{"version":3,"file":"message_drawer_view_search.min.js","sources":["../src/message_drawer_view_search.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Controls the search page of the message drawer.\r\n *\r\n * @module     core_message/message_drawer_view_search\r\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(\r\n[\r\n    'jquery',\r\n    'core/custom_interaction_events',\r\n    'core/notification',\r\n    'core/pubsub',\r\n    'core/str',\r\n    'core/templates',\r\n    'core_message/message_repository',\r\n    'core_message/message_drawer_events',\r\n],\r\nfunction(\r\n    $,\r\n    CustomEvents,\r\n    Notification,\r\n    PubSub,\r\n    Str,\r\n    Templates,\r\n    Repository,\r\n    Events\r\n) {\r\n\r\n    var MESSAGE_SEARCH_LIMIT = 50;\r\n    var USERS_SEARCH_LIMIT = 50;\r\n    var USERS_INITIAL_SEARCH_LIMIT = 3;\r\n\r\n    var SELECTORS = {\r\n        BLOCK_ICON_CONTAINER: '[data-region=\"block-icon-container\"]',\r\n        CANCEL_SEARCH_BUTTON: '[data-action=\"cancel-search\"]',\r\n        CONTACTS_CONTAINER: '[data-region=\"contacts-container\"]',\r\n        CONTACTS_LIST: '[data-region=\"contacts-container\"] [data-region=\"list\"]',\r\n        EMPTY_MESSAGE_CONTAINER: '[data-region=\"empty-message-container\"]',\r\n        LIST: '[data-region=\"list\"]',\r\n        LOADING_ICON_CONTAINER: '[data-region=\"loading-icon-container\"]',\r\n        LOADING_PLACEHOLDER: '[data-region=\"loading-placeholder\"]',\r\n        MESSAGES_LIST: '[data-region=\"messages-container\"] [data-region=\"list\"]',\r\n        MESSAGES_CONTAINER: '[data-region=\"messages-container\"]',\r\n        NON_CONTACTS_CONTAINER: '[data-region=\"non-contacts-container\"]',\r\n        NON_CONTACTS_LIST: '[data-region=\"non-contacts-container\"] [data-region=\"list\"]',\r\n        SEARCH_ICON_CONTAINER: '[data-region=\"search-icon-container\"]',\r\n        SEARCH_ACTION: '[data-action=\"search\"]',\r\n        SEARCH_INPUT: '[data-region=\"search-input\"]',\r\n        SEARCH_RESULTS_CONTAINER: '[data-region=\"search-results-container\"]',\r\n        LOAD_MORE_USERS: '[data-action=\"load-more-users\"]',\r\n        LOAD_MORE_MESSAGES: '[data-action=\"load-more-messages\"]',\r\n        BUTTON_TEXT: '[data-region=\"button-text\"]',\r\n        NO_RESULTS_CONTAINTER: '[data-region=\"no-results-container\"]',\r\n        ALL_CONTACTS_CONTAINER: '[data-region=\"all-contacts-container\"]'\r\n    };\r\n\r\n    var TEMPLATES = {\r\n        CONTACTS_LIST: 'core_message/message_drawer_contacts_list',\r\n        NON_CONTACTS_LIST: 'core_message/message_drawer_non_contacts_list',\r\n        MESSAGES_LIST: 'core_message/message_drawer_messages_list'\r\n    };\r\n\r\n    /**\r\n     * Get the logged in user id.\r\n     *\r\n     * @param  {Object} body Search body container element.\r\n     * @return {Number} User id.\r\n     */\r\n    var getLoggedInUserId = function(body) {\r\n        return body.attr('data-user-id');\r\n    };\r\n\r\n    /**\r\n     * Show the no messages container element.\r\n     *\r\n     * @param  {Object} body Search body container element.\r\n     * @return {Object} No messages container element.\r\n     */\r\n    var getEmptyMessageContainer = function(body) {\r\n        return body.find(SELECTORS.EMPTY_MESSAGE_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the search loading icon.\r\n     *\r\n     * @param  {Object} header Search header container element.\r\n     * @return {Object} Loading icon element.\r\n     */\r\n    var getLoadingIconContainer = function(header) {\r\n        return header.find(SELECTORS.LOADING_ICON_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the loading container element.\r\n     *\r\n     * @param  {Object} body Search body container element.\r\n     * @return {Object} Loading container element.\r\n     */\r\n    var getLoadingPlaceholder = function(body) {\r\n        return body.find(SELECTORS.LOADING_PLACEHOLDER);\r\n    };\r\n\r\n    /**\r\n     * Get the search icon container.\r\n     *\r\n     * @param  {Object} header Search header container element.\r\n     * @return {Object} Search icon container.\r\n     */\r\n    var getSearchIconContainer = function(header) {\r\n        return header.find(SELECTORS.SEARCH_ICON_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the search input container.\r\n     *\r\n     * @param  {Object} header Search header container element.\r\n     * @return {Object} Search input container.\r\n     */\r\n    var getSearchInput = function(header) {\r\n        return header.find(SELECTORS.SEARCH_INPUT);\r\n    };\r\n\r\n    /**\r\n     * Get the search results container.\r\n     *\r\n     * @param  {Object} body Search body container element.\r\n     * @return {Object} Search results container.\r\n     */\r\n    var getSearchResultsContainer = function(body) {\r\n        return body.find(SELECTORS.SEARCH_RESULTS_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the search contacts container.\r\n     *\r\n     * @param  {Object} body Search body container element.\r\n     * @return {Object} Search contacts container.\r\n     */\r\n    var getContactsContainer = function(body) {\r\n        return body.find(SELECTORS.CONTACTS_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the search non contacts container.\r\n     *\r\n     * @param  {Object} body Search body container element.\r\n     * @return {Object} Search non contacts container.\r\n     */\r\n    var getNonContactsContainer = function(body) {\r\n        return body.find(SELECTORS.NON_CONTACTS_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the search messages container.\r\n     *\r\n     * @param  {Object} body Search body container element.\r\n     * @return {Object} Search messages container.\r\n     */\r\n    var getMessagesContainer = function(body) {\r\n        return body.find(SELECTORS.MESSAGES_CONTAINER);\r\n    };\r\n\r\n\r\n    /**\r\n     * Show the messages empty container.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showEmptyMessage = function(body) {\r\n        getEmptyMessageContainer(body).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the messages empty container.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideEmptyMessage = function(body) {\r\n        getEmptyMessageContainer(body).addClass('hidden');\r\n    };\r\n\r\n\r\n    /**\r\n     * Show the loading icon.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     */\r\n    var showLoadingIcon = function(header) {\r\n        getLoadingIconContainer(header).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the loading icon.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     */\r\n    var hideLoadingIcon = function(header) {\r\n        getLoadingIconContainer(header).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show loading placeholder.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showLoadingPlaceholder = function(body) {\r\n        getLoadingPlaceholder(body).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide loading placeholder.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideLoadingPlaceholder = function(body) {\r\n        getLoadingPlaceholder(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show search icon.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     */\r\n    var showSearchIcon = function(header) {\r\n        getSearchIconContainer(header).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide search icon.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     */\r\n    var hideSearchIcon = function(header) {\r\n        getSearchIconContainer(header).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show search results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showSearchResults = function(body) {\r\n        getSearchResultsContainer(body).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide search results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideSearchResults = function(body) {\r\n        getSearchResultsContainer(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the no search results message.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showNoSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).addClass('hidden');\r\n        container.find(SELECTORS.MESSAGES_CONTAINER).addClass('hidden');\r\n        container.find(SELECTORS.NO_RESULTS_CONTAINTER).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the no search results message.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideNoSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).removeClass('hidden');\r\n        container.find(SELECTORS.MESSAGES_CONTAINER).removeClass('hidden');\r\n        container.find(SELECTORS.NO_RESULTS_CONTAINTER).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the whole contacts results area.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showAllContactsSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the whole contacts results area.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideAllContactsSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the contacts results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showContactsSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.CONTACTS_CONTAINER).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the contacts results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideContactsSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.CONTACTS_CONTAINER).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the non contacts results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showNonContactsSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.NON_CONTACTS_CONTAINER).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the non contacts results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideNonContactsSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.NON_CONTACTS_CONTAINER).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the messages results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var showMessagesSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.MESSAGES_CONTAINER).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the messages results.\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var hideMessagesSearchResults = function(body) {\r\n        var container = getSearchResultsContainer(body);\r\n        container.find(SELECTORS.MESSAGES_CONTAINER).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Disable the search input.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     */\r\n    var disableSearchInput = function(header) {\r\n        getSearchInput(header).prop('disabled', true);\r\n    };\r\n\r\n    /**\r\n     * Enable the search input.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     */\r\n    var enableSearchInput = function(header) {\r\n        getSearchInput(header).prop('disabled', false);\r\n    };\r\n\r\n    /**\r\n     * Clear the search input.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     */\r\n    var clearSearchInput = function(header) {\r\n        getSearchInput(header).val('');\r\n    };\r\n\r\n    /**\r\n     * Clear all search results\r\n     *\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var clearAllSearchResults = function(body) {\r\n        body.find(SELECTORS.CONTACTS_LIST).empty();\r\n        body.find(SELECTORS.NON_CONTACTS_LIST).empty();\r\n        body.find(SELECTORS.MESSAGES_LIST).empty();\r\n        hideNoSearchResults(body);\r\n        showAllContactsSearchResults(body);\r\n        showContactsSearchResults(body);\r\n        showNonContactsSearchResults(body);\r\n        showMessagesSearchResults(body);\r\n        showLoadMoreUsersButton(body);\r\n        showLoadMoreMessagesButton(body);\r\n    };\r\n\r\n    /**\r\n     * Update the body and header to indicate the search is loading.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var startLoading = function(header, body) {\r\n        hideSearchIcon(header);\r\n        hideEmptyMessage(body);\r\n        hideSearchResults(body);\r\n        showLoadingIcon(header);\r\n        showLoadingPlaceholder(body);\r\n        disableSearchInput(header);\r\n    };\r\n\r\n    /**\r\n     * Update the body and header to indicate the search has stopped loading.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var stopLoading = function(header, body) {\r\n        showSearchIcon(header);\r\n        hideEmptyMessage(body);\r\n        showSearchResults(body);\r\n        hideLoadingIcon(header);\r\n        hideLoadingPlaceholder(body);\r\n        enableSearchInput(header);\r\n    };\r\n\r\n    /**\r\n     * Show the more users loading icon.\r\n     *\r\n     * @param {Object} root The more users container element.\r\n     */\r\n    var showUsersLoadingIcon = function(root) {\r\n        var button = root.find(SELECTORS.LOAD_MORE_USERS);\r\n        button.prop('disabled', true);\r\n        button.find(SELECTORS.BUTTON_TEXT).addClass('hidden');\r\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the more users loading icon.\r\n     *\r\n     * @param {Object} root The more users container element.\r\n     */\r\n    var hideUsersLoadingIcon = function(root) {\r\n        var button = root.find(SELECTORS.LOAD_MORE_USERS);\r\n        button.prop('disabled', false);\r\n        button.find(SELECTORS.BUTTON_TEXT).removeClass('hidden');\r\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the load more users button.\r\n     *\r\n     * @param {Object} root The users container element.\r\n     */\r\n    var showLoadMoreUsersButton = function(root) {\r\n        root.find(SELECTORS.LOAD_MORE_USERS).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the load more users button.\r\n     *\r\n     * @param {Object} root The users container element.\r\n     */\r\n    var hideLoadMoreUsersButton = function(root) {\r\n        root.find(SELECTORS.LOAD_MORE_USERS).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the messages are loading icon.\r\n     *\r\n     * @param {Object} root Messages root element.\r\n     */\r\n    var showMessagesLoadingIcon = function(root) {\r\n        var button = root.find(SELECTORS.LOAD_MORE_MESSAGES);\r\n        button.prop('disabled', true);\r\n        button.find(SELECTORS.BUTTON_TEXT).addClass('hidden');\r\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the messages are loading icon.\r\n     *\r\n     * @param {Object} root Messages root element.\r\n     */\r\n    var hideMessagesLoadingIcon = function(root) {\r\n        var button = root.find(SELECTORS.LOAD_MORE_MESSAGES);\r\n        button.prop('disabled', false);\r\n        button.find(SELECTORS.BUTTON_TEXT).removeClass('hidden');\r\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the load more messages button.\r\n     *\r\n     * @param  {Object} root The messages container element.\r\n     */\r\n    var showLoadMoreMessagesButton = function(root) {\r\n        root.find(SELECTORS.LOAD_MORE_MESSAGES).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the load more messages button.\r\n     *\r\n     * @param  {Object} root The messages container element.\r\n     */\r\n    var hideLoadMoreMessagesButton = function(root) {\r\n        root.find(SELECTORS.LOAD_MORE_MESSAGES).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Find a contact in the search results.\r\n     *\r\n     * @param  {Object} root Search results container element.\r\n     * @param  {Number} userId User id.\r\n     * @return {Object} User container element.\r\n     */\r\n    var findContact = function(root, userId) {\r\n        return root.find('[data-contact-user-id=\"' + userId + '\"]');\r\n    };\r\n\r\n    /**\r\n     * Add a contact to the search results.\r\n     *\r\n     * @param {Object} root Search results container.\r\n     * @param {Object} contact User in contacts list.\r\n     */\r\n    var addContact = function(root, contact) {\r\n        var nonContactsContainer = getNonContactsContainer(root);\r\n        var nonContact = findContact(nonContactsContainer, contact.userid);\r\n\r\n        if (nonContact.length) {\r\n            nonContact.remove();\r\n            var contactsContainer = getContactsContainer(root);\r\n            contactsContainer.removeClass('hidden');\r\n            contactsContainer.find(SELECTORS.LIST).append(nonContact);\r\n        }\r\n\r\n        if (!nonContactsContainer.find(SELECTORS.LIST).children().length) {\r\n            nonContactsContainer.addClass('hidden');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Remove a contact from the contacts results.\r\n     *\r\n     * @param {Object} root Search results container.\r\n     * @param {Object} userId Contact user id.\r\n     */\r\n    var removeContact = function(root, userId) {\r\n        var contactsContainer = getContactsContainer(root);\r\n        var contact = findContact(contactsContainer, userId);\r\n\r\n        if (contact.length) {\r\n            contact.remove();\r\n            var nonContactsContainer = getNonContactsContainer(root);\r\n            nonContactsContainer.removeClass('hidden');\r\n            nonContactsContainer.find(SELECTORS.LIST).append(contact);\r\n        }\r\n\r\n        if (!contactsContainer.find(SELECTORS.LIST).children().length) {\r\n            contactsContainer.addClass('hidden');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show the contact is blocked icon.\r\n     *\r\n     * @param {Object} root Search results container.\r\n     * @param {Object} userId Contact user id.\r\n     */\r\n    var blockContact = function(root, userId) {\r\n        var contact = findContact(root, userId);\r\n        if (contact.length) {\r\n            contact.find(SELECTORS.BLOCK_ICON_CONTAINER).removeClass('hidden');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide the contact is blocked icon.\r\n     *\r\n     * @param {Object} root Search results container.\r\n     * @param {Object} userId Contact user id.\r\n     */\r\n    var unblockContact = function(root, userId) {\r\n        var contact = findContact(root, userId);\r\n        if (contact.length) {\r\n            contact.find(SELECTORS.BLOCK_ICON_CONTAINER).addClass('hidden');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Highlight words in search results.\r\n     *\r\n     * @param  {String} content HTML to search.\r\n     * @param  {String} searchText Search text.\r\n     * @return {String} searchText with search wrapped in matchtext span.\r\n     */\r\n    var highlightSearch = function(content, searchText) {\r\n        if (!content) {\r\n            return '';\r\n        }\r\n        var regex = new RegExp('(' + searchText + ')', 'gi');\r\n        return content.replace(regex, '<span class=\"matchtext\">$1</span>');\r\n    };\r\n\r\n\r\n    /**\r\n     * Render contacts in the contacts search results.\r\n     *\r\n     * @param {Object} root Search results container.\r\n     * @param {Array} contacts List of contacts.\r\n     * @return {Promise} Renderer promise.\r\n     */\r\n    var renderContacts = function(root, contacts) {\r\n        var container = getContactsContainer(root);\r\n        var frompanel = root.attr('data-in-panel');\r\n        var list = container.find(SELECTORS.LIST);\r\n\r\n        return Templates.render(TEMPLATES.CONTACTS_LIST, {contacts: contacts, frompanel: frompanel})\r\n            .then(function(html) {\r\n                list.append(html);\r\n                return html;\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Render non contacts in the contacts search results.\r\n     *\r\n     * @param {Object} root Search results container.\r\n     * @param {Array} nonContacts List of non contacts.\r\n     * @return {Promise} Renderer promise.\r\n     */\r\n    var renderNonContacts = function(root, nonContacts) {\r\n        var container = getNonContactsContainer(root);\r\n        var frompanel = root.attr('data-in-panel');\r\n        var list = container.find(SELECTORS.LIST);\r\n\r\n        return Templates.render(TEMPLATES.NON_CONTACTS_LIST, {noncontacts: nonContacts, frompanel: frompanel})\r\n            .then(function(html) {\r\n                list.append(html);\r\n                return html;\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Render messages in the messages search results.\r\n     *\r\n     * @param {Object} root Search results container.\r\n     * @param {Array} messages List of messages.\r\n     * @return {Promise} Renderer promise.\r\n     */\r\n    var renderMessages = function(root, messages) {\r\n        var container = getMessagesContainer(root);\r\n        var frompanel = root.attr('data-in-panel');\r\n        var list = container.find(SELECTORS.LIST);\r\n\r\n        return Templates.render(TEMPLATES.MESSAGES_LIST, {messages: messages, frompanel: frompanel})\r\n            .then(function(html) {\r\n                list.append(html);\r\n                return html;\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Load more users from the repository and render the results into the users search results.\r\n     *\r\n     * @param  {Object} root Search results container.\r\n     * @param  {Number} loggedInUserId Current logged in user.\r\n     * @param  {String} text Search text.\r\n     * @param  {Number} limit Number of users to get.\r\n     * @param  {Number} offset Load users from\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var loadMoreUsers = function(root, loggedInUserId, text, limit, offset) {\r\n        var loadedAll = false;\r\n        showUsersLoadingIcon(root);\r\n\r\n        return Repository.searchUsers(loggedInUserId, text, limit + 1, offset)\r\n            .then(function(results) {\r\n                var contacts = results.contacts;\r\n                var noncontacts = results.noncontacts;\r\n\r\n                if (contacts.length <= limit && noncontacts.length <= limit) {\r\n                    loadedAll = true;\r\n                    return {\r\n                        contacts: contacts,\r\n                        noncontacts: noncontacts\r\n                    };\r\n                } else {\r\n                    return {\r\n                        contacts: contacts.slice(0, limit),\r\n                        noncontacts: noncontacts.slice(0, limit)\r\n                    };\r\n                }\r\n            })\r\n            .then(function(results) {\r\n                var contactsCount = results.contacts.length;\r\n                var nonContactsCount = results.noncontacts.length;\r\n\r\n                if (contactsCount) {\r\n                    results.contacts.forEach(function(contact) {\r\n                        contact.highlight = highlightSearch(contact.fullname, text);\r\n                    });\r\n                }\r\n\r\n                if (nonContactsCount) {\r\n                    results.noncontacts.forEach(function(contact) {\r\n                        contact.highlight = highlightSearch(contact.fullname, text);\r\n                    });\r\n                }\r\n\r\n                return $.when(\r\n                    contactsCount ? renderContacts(root, results.contacts) : true,\r\n                    nonContactsCount ? renderNonContacts(root, results.noncontacts) : true\r\n                )\r\n                .then(function() {\r\n                    return {\r\n                        contactsCount: contactsCount,\r\n                        nonContactsCount: nonContactsCount\r\n                    };\r\n                });\r\n            })\r\n            .then(function(counts) {\r\n                hideUsersLoadingIcon(root);\r\n\r\n                if (loadedAll) {\r\n                    hideLoadMoreUsersButton(root);\r\n                }\r\n\r\n                return counts;\r\n            })\r\n            .catch(function(error) {\r\n                hideUsersLoadingIcon(root);\r\n                // Rethrow error for other handlers.\r\n                throw error;\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Load more messages from the repository and render the results into the messages search results.\r\n     *\r\n     * @param  {Object} root Search results container.\r\n     * @param  {Number} loggedInUserId Current logged in user.\r\n     * @param  {String} text Search text.\r\n     * @param  {Number} limit Number of messages to get.\r\n     * @param  {Number} offset Load messages from\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var loadMoreMessages = function(root, loggedInUserId, text, limit, offset) {\r\n        var loadedAll = false;\r\n        showMessagesLoadingIcon(root);\r\n\r\n        return Repository.searchMessages(loggedInUserId, text, limit + 1, offset)\r\n            .then(function(results) {\r\n                var messages = results.contacts;\r\n\r\n                if (messages.length <= limit) {\r\n                    loadedAll = true;\r\n                    return messages;\r\n                } else {\r\n                    return messages.slice(0, limit);\r\n                }\r\n            })\r\n            .then(function(messages) {\r\n                if (messages.length) {\r\n                    messages.forEach(function(message) {\r\n                        message.lastmessage = highlightSearch(message.lastmessage, text);\r\n                    });\r\n                    return renderMessages(root, messages)\r\n                        .then(function() {\r\n                            return messages.length;\r\n                        });\r\n                } else {\r\n                    return messages.length;\r\n                }\r\n            })\r\n            .then(function(count) {\r\n                hideMessagesLoadingIcon(root);\r\n\r\n                if (loadedAll) {\r\n                    hideLoadMoreMessagesButton(root);\r\n                }\r\n\r\n                return count;\r\n            })\r\n            .catch(function(error) {\r\n                hideMessagesLoadingIcon(root);\r\n                // Rethrow error for other handlers.\r\n                throw error;\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Search for users and messages.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     * @param {Object} body Search body container element.\r\n     * @param {String} searchText Search text.\r\n     * @param {Number} usersLimit The users limit.\r\n     * @param {Number} usersOffset The users offset.\r\n     * @param {Number} messagesLimit The message limit.\r\n     * @param {Number} messagesOffset The message offset.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var search = function(header, body, searchText, usersLimit, usersOffset, messagesLimit, messagesOffset) {\r\n        var loggedInUserId = getLoggedInUserId(body);\r\n        startLoading(header, body);\r\n        clearAllSearchResults(body);\r\n\r\n        return $.when(\r\n            loadMoreUsers(body, loggedInUserId, searchText, usersLimit, usersOffset),\r\n            loadMoreMessages(body, loggedInUserId, searchText, messagesLimit, messagesOffset)\r\n        )\r\n        .then(function(userCounts, messagesCount) {\r\n            var contactsCount = userCounts.contactsCount;\r\n            var nonContactsCount = userCounts.nonContactsCount;\r\n\r\n            stopLoading(header, body);\r\n\r\n            if (!contactsCount && !nonContactsCount && !messagesCount) {\r\n                showNoSearchResults(body);\r\n            } else {\r\n                if (!contactsCount && !nonContactsCount) {\r\n                    hideAllContactsSearchResults(body);\r\n                } else {\r\n                    if (!contactsCount) {\r\n                        hideContactsSearchResults(body);\r\n                    }\r\n\r\n                    if (!nonContactsCount) {\r\n                        hideNonContactsSearchResults(body);\r\n                    }\r\n                }\r\n\r\n                if (!messagesCount) {\r\n                    hideMessagesSearchResults(body);\r\n                }\r\n            }\r\n\r\n            return;\r\n        });\r\n    };\r\n\r\n\r\n    /**\r\n     * Listen to and handle events for searching.\r\n     *\r\n     * @param {Object} header Search header container element.\r\n     * @param {Object} body Search body container element.\r\n     */\r\n    var registerEventListeners = function(header, body) {\r\n        var loggedInUserId = getLoggedInUserId(body);\r\n        var searchInput = getSearchInput(header);\r\n        var searchText = '';\r\n        var messagesOffset = 0;\r\n        var usersOffset = 0;\r\n\r\n        var searchEventHandler = function(e, data) {\r\n            searchText = searchInput.val().trim();\r\n\r\n            if (searchText !== '') {\r\n                messagesOffset = 0;\r\n                usersOffset = 0;\r\n                search(\r\n                    header,\r\n                    body,\r\n                    searchText,\r\n                    USERS_INITIAL_SEARCH_LIMIT,\r\n                    usersOffset,\r\n                    MESSAGE_SEARCH_LIMIT,\r\n                    messagesOffset\r\n                )\r\n                .then(function() {\r\n                    searchInput.focus();\r\n                    usersOffset = usersOffset + USERS_INITIAL_SEARCH_LIMIT;\r\n                    messagesOffset = messagesOffset + MESSAGE_SEARCH_LIMIT;\r\n                    return;\r\n                })\r\n                .catch(Notification.exception);\r\n            }\r\n\r\n            data.originalEvent.preventDefault();\r\n        };\r\n\r\n        CustomEvents.define(searchInput, [CustomEvents.events.enter]);\r\n        CustomEvents.define(header, [CustomEvents.events.activate]);\r\n        CustomEvents.define(body, [CustomEvents.events.activate]);\r\n\r\n        searchInput.on(CustomEvents.events.enter, searchEventHandler);\r\n\r\n        header.on(CustomEvents.events.activate, SELECTORS.SEARCH_ACTION, searchEventHandler);\r\n\r\n        body.on(CustomEvents.events.activate, SELECTORS.LOAD_MORE_MESSAGES, function(e, data) {\r\n            if (searchText !== '') {\r\n                loadMoreMessages(body, loggedInUserId, searchText, MESSAGE_SEARCH_LIMIT, messagesOffset)\r\n                    .then(function() {\r\n                        messagesOffset = messagesOffset + MESSAGE_SEARCH_LIMIT;\r\n                        return;\r\n                    })\r\n                    .catch(Notification.exception);\r\n            }\r\n            data.originalEvent.preventDefault();\r\n        });\r\n\r\n        body.on(CustomEvents.events.activate, SELECTORS.LOAD_MORE_USERS, function(e, data) {\r\n            if (searchText !== '') {\r\n                loadMoreUsers(body, loggedInUserId, searchText, USERS_SEARCH_LIMIT, usersOffset)\r\n                    .then(function() {\r\n                        usersOffset = usersOffset + USERS_SEARCH_LIMIT;\r\n                        return;\r\n                    })\r\n                    .catch(Notification.exception);\r\n            }\r\n            data.originalEvent.preventDefault();\r\n        });\r\n\r\n        header.on(CustomEvents.events.activate, SELECTORS.CANCEL_SEARCH_BUTTON, function() {\r\n            clearSearchInput(header);\r\n            showEmptyMessage(body);\r\n            showSearchIcon(header);\r\n            hideSearchResults(body);\r\n            hideLoadingIcon(header);\r\n            hideLoadingPlaceholder(body);\r\n            usersOffset = 0;\r\n            messagesOffset = 0;\r\n        });\r\n\r\n        PubSub.subscribe(Events.CONTACT_ADDED, function(userId) {\r\n            addContact(body, userId);\r\n        });\r\n\r\n        PubSub.subscribe(Events.CONTACT_REMOVED, function(userId) {\r\n            removeContact(body, userId);\r\n        });\r\n\r\n        PubSub.subscribe(Events.CONTACT_BLOCKED, function(userId) {\r\n            blockContact(body, userId);\r\n        });\r\n\r\n        PubSub.subscribe(Events.CONTACT_UNBLOCKED, function(userId) {\r\n            unblockContact(body, userId);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Setup the search page.\r\n     *\r\n     * @param {string} namespace The route namespace.\r\n     * @param {Object} header Contacts header container element.\r\n     * @param {Object} body Contacts body container element.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var show = function(namespace, header, body) {\r\n        if (!body.attr('data-init')) {\r\n            registerEventListeners(header, body);\r\n            body.attr('data-init', true);\r\n        }\r\n        var searchInput = getSearchInput(header);\r\n        searchInput.focus();\r\n\r\n        return $.Deferred().resolve().promise();\r\n    };\r\n\r\n    /**\r\n     * String describing this page used for aria-labels.\r\n     *\r\n     * @param {string} namespace The route namespace.\r\n     * @param {Object} header Contacts header container element.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var description = function(namespace, header) {\r\n        if (typeof header !== 'object') {\r\n            return Str.get_string('messagedrawerviewsearch', 'core_message');\r\n        }\r\n        var searchInput = getSearchInput(header);\r\n        var searchText = searchInput.val().trim();\r\n        return Str.get_string('messagedrawerviewsearch', 'core_message', searchText);\r\n    };\r\n\r\n    return {\r\n        show: show,\r\n        description: description\r\n    };\r\n});\r\n"],"names":["define","$","CustomEvents","Notification","PubSub","Str","Templates","Repository","Events","SELECTORS","TEMPLATES","getLoggedInUserId","body","attr","getEmptyMessageContainer","find","getLoadingIconContainer","header","getLoadingPlaceholder","getSearchIconContainer","getSearchInput","getSearchResultsContainer","getContactsContainer","getNonContactsContainer","hideEmptyMessage","addClass","hideLoadingIcon","hideLoadingPlaceholder","showSearchIcon","removeClass","hideSearchResults","clearAllSearchResults","empty","container","hideNoSearchResults","showAllContactsSearchResults","showContactsSearchResults","showNonContactsSearchResults","showMessagesSearchResults","showLoadMoreUsersButton","showLoadMoreMessagesButton","startLoading","hideSearchIcon","showLoadingIcon","showLoadingPlaceholder","prop","disableSearchInput","stopLoading","showSearchResults","enableSearchInput","hideUsersLoadingIcon","root","button","hideMessagesLoadingIcon","findContact","userId","highlightSearch","content","searchText","regex","RegExp","replace","renderMessages","messages","frompanel","list","render","then","html","append","loadMoreUsers","loggedInUserId","text","limit","offset","loadedAll","showUsersLoadingIcon","searchUsers","results","contacts","noncontacts","length","slice","contactsCount","nonContactsCount","forEach","contact","highlight","fullname","when","renderContacts","nonContacts","renderNonContacts","counts","hideLoadMoreUsersButton","catch","error","loadMoreMessages","showMessagesLoadingIcon","searchMessages","message","lastmessage","count","hideLoadMoreMessagesButton","search","usersLimit","usersOffset","messagesLimit","messagesOffset","userCounts","messagesCount","hideContactsSearchResults","hideNonContactsSearchResults","hideAllContactsSearchResults","hideMessagesSearchResults","showNoSearchResults","registerEventListeners","searchInput","searchEventHandler","e","data","val","trim","focus","exception","originalEvent","preventDefault","events","enter","activate","on","clearSearchInput","showEmptyMessage","subscribe","CONTACT_ADDED","nonContactsContainer","nonContact","userid","remove","contactsContainer","children","addContact","CONTACT_REMOVED","removeContact","CONTACT_BLOCKED","blockContact","CONTACT_UNBLOCKED","unblockContact","show","namespace","Deferred","resolve","promise","description","get_string"],"mappings":"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"}