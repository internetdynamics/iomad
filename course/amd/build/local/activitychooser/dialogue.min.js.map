{"version":3,"file":"dialogue.min.js","sources":["../../../src/local/activitychooser/dialogue.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * A type of dialogue used as for choosing options.\r\n *\r\n * @module     core_course/local/activitychooser/dialogue\r\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport * as ModalEvents from 'core/modal_events';\r\nimport selectors from 'core_course/local/activitychooser/selectors';\r\nimport * as Templates from 'core/templates';\r\nimport {end, arrowLeft, arrowRight, home, enter, space} from 'core/key_codes';\r\nimport {addIconToContainer} from 'core/loadingicon';\r\nimport * as Repository from 'core_course/local/activitychooser/repository';\r\nimport Notification from 'core/notification';\r\nimport {debounce} from 'core/utils';\r\nconst getPlugin = pluginName => import(pluginName);\r\n\r\n/**\r\n * Given an event from the main module 'page' navigate to it's help section via a carousel.\r\n *\r\n * @method showModuleHelp\r\n * @param {jQuery} carousel Our initialized carousel to manipulate\r\n * @param {Object} moduleData Data of the module to carousel to\r\n * @param {jQuery} modal We need to figure out if the current modal has a footer.\r\n */\r\nconst showModuleHelp = (carousel, moduleData, modal = null) => {\r\n    // If we have a real footer then we need to change temporarily.\r\n    if (modal !== null && moduleData.showFooter === true) {\r\n        modal.setFooter(Templates.render('core_course/local/activitychooser/footer_partial', moduleData));\r\n    }\r\n    const help = carousel.find(selectors.regions.help)[0];\r\n    help.innerHTML = '';\r\n    help.classList.add('m-auto');\r\n\r\n    // Add a spinner.\r\n    const spinnerPromise = addIconToContainer(help);\r\n\r\n    // Used later...\r\n    let transitionPromiseResolver = null;\r\n    const transitionPromise = new Promise(resolve => {\r\n        transitionPromiseResolver = resolve;\r\n    });\r\n\r\n    // Build up the html & js ready to place into the help section.\r\n    const contentPromise = Templates.renderForPromise('core_course/local/activitychooser/help', moduleData);\r\n\r\n    // Wait for the content to be ready, and for the transition to be complet.\r\n    Promise.all([contentPromise, spinnerPromise, transitionPromise])\r\n        .then(([{html, js}]) => Templates.replaceNodeContents(help, html, js))\r\n        .then(() => {\r\n            help.querySelector(selectors.regions.chooserSummary.header).focus();\r\n            return help;\r\n        })\r\n        .catch(Notification.exception);\r\n\r\n    // Move to the next slide, and resolve the transition promise when it's done.\r\n    carousel.one('slid.bs.carousel', () => {\r\n        transitionPromiseResolver();\r\n    });\r\n    // Trigger the transition between 'pages'.\r\n    carousel.carousel('next');\r\n};\r\n\r\n/**\r\n * Given a user wants to change the favourite state of a module we either add or remove the status.\r\n * We also propergate this change across our map of modals.\r\n *\r\n * @method manageFavouriteState\r\n * @param {HTMLElement} modalBody The DOM node of the modal to manipulate\r\n * @param {HTMLElement} caller\r\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\r\n */\r\nconst manageFavouriteState = async(modalBody, caller, partialFavourite) => {\r\n    const isFavourite = caller.dataset.favourited;\r\n    const id = caller.dataset.id;\r\n    const name = caller.dataset.name;\r\n    const internal = caller.dataset.internal;\r\n    // Switch on fave or not.\r\n    if (isFavourite === 'true') {\r\n        await Repository.unfavouriteModule(name, id);\r\n\r\n        partialFavourite(internal, false, modalBody);\r\n    } else {\r\n        await Repository.favouriteModule(name, id);\r\n\r\n        partialFavourite(internal, true, modalBody);\r\n    }\r\n\r\n};\r\n\r\n/**\r\n * Register chooser related event listeners.\r\n *\r\n * @method registerListenerEvents\r\n * @param {Promise} modal Our modal that we are working with\r\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\r\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\r\n * @param {Object} footerData Our base footer object.\r\n */\r\nconst registerListenerEvents = (modal, mappedModules, partialFavourite, footerData) => {\r\n    const bodyClickListener = async(e) => {\r\n        if (e.target.closest(selectors.actions.optionActions.showSummary)) {\r\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\r\n\r\n            const module = e.target.closest(selectors.regions.chooserOption.container);\r\n            const moduleName = module.dataset.modname;\r\n            const moduleData = mappedModules.get(moduleName);\r\n            // We need to know if the overall modal has a footer so we know when to show a real / vs fake footer.\r\n            moduleData.showFooter = modal.hasFooterContent();\r\n            showModuleHelp(carousel, moduleData, modal);\r\n        }\r\n\r\n        if (e.target.closest(selectors.actions.optionActions.manageFavourite)) {\r\n            const caller = e.target.closest(selectors.actions.optionActions.manageFavourite);\r\n            await manageFavouriteState(modal.getBody()[0], caller, partialFavourite);\r\n            const activeSectionId = modal.getBody()[0].querySelector(selectors.elements.activetab).getAttribute(\"href\");\r\n            const sectionChooserOptions = modal.getBody()[0]\r\n                .querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\r\n            const firstChooserOption = sectionChooserOptions\r\n                .querySelector(selectors.regions.chooserOption.container);\r\n            toggleFocusableChooserOption(firstChooserOption, true);\r\n            initChooserOptionsKeyboardNavigation(modal.getBody()[0], mappedModules, sectionChooserOptions, modal);\r\n        }\r\n\r\n        // From the help screen go back to the module overview.\r\n        if (e.target.matches(selectors.actions.closeOption)) {\r\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\r\n\r\n            // Trigger the transition between 'pages'.\r\n            carousel.carousel('prev');\r\n            carousel.on('slid.bs.carousel', () => {\r\n                const allModules = modal.getBody()[0].querySelector(selectors.regions.modules);\r\n                const caller = allModules.querySelector(selectors.regions.getModuleSelector(e.target.dataset.modname));\r\n                caller.focus();\r\n            });\r\n        }\r\n\r\n        // The \"clear search\" button is triggered.\r\n        if (e.target.closest(selectors.actions.clearSearch)) {\r\n            // Clear the entered search query in the search bar and hide the search results container.\r\n            const searchInput = modal.getBody()[0].querySelector(selectors.actions.search);\r\n            searchInput.value = \"\";\r\n            searchInput.focus();\r\n            toggleSearchResultsView(modal, mappedModules, searchInput.value);\r\n        }\r\n    };\r\n\r\n    // We essentially have two types of footer.\r\n    // A fake one that is handled within the template for chooser_help and then all of the stuff for\r\n    // modal.footer. We need to ensure we know exactly what type of footer we are using so we know what we\r\n    // need to manage. The below code handles a real footer going to a mnet carousel item.\r\n    const footerClickListener = async(e) => {\r\n        if (footerData.footer === true) {\r\n            const footerjs = await getPlugin(footerData.customfooterjs);\r\n            await footerjs.footerClickListener(e, footerData, modal);\r\n        }\r\n    };\r\n\r\n    modal.getBodyPromise()\r\n\r\n    // The return value of getBodyPromise is a jquery object containing the body NodeElement.\r\n    .then(body => body[0])\r\n\r\n    // Set up the carousel.\r\n    .then(body => {\r\n        $(body.querySelector(selectors.regions.carousel))\r\n            .carousel({\r\n                interval: false,\r\n                pause: true,\r\n                keyboard: false\r\n            });\r\n\r\n        return body;\r\n    })\r\n\r\n    // Add the listener for clicks on the body.\r\n    .then(body => {\r\n        body.addEventListener('click', bodyClickListener);\r\n        return body;\r\n    })\r\n\r\n    // Add a listener for an input change in the activity chooser's search bar.\r\n    .then(body => {\r\n        const searchInput = body.querySelector(selectors.actions.search);\r\n        // The search input is triggered.\r\n        searchInput.addEventListener('input', debounce(() => {\r\n            // Display the search results.\r\n            toggleSearchResultsView(modal, mappedModules, searchInput.value);\r\n        }, 300));\r\n        return body;\r\n    })\r\n\r\n    // Register event listeners related to the keyboard navigation controls.\r\n    .then(body => {\r\n        // Get the active chooser options section.\r\n        const activeSectionId = body.querySelector(selectors.elements.activetab).getAttribute(\"href\");\r\n        const sectionChooserOptions = body.querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\r\n        const firstChooserOption = sectionChooserOptions.querySelector(selectors.regions.chooserOption.container);\r\n\r\n        toggleFocusableChooserOption(firstChooserOption, true);\r\n        initChooserOptionsKeyboardNavigation(body, mappedModules, sectionChooserOptions, modal);\r\n\r\n        return body;\r\n    })\r\n    .catch();\r\n\r\n    modal.getFooterPromise()\r\n\r\n    // The return value of getBodyPromise is a jquery object containing the body NodeElement.\r\n    .then(footer => footer[0])\r\n    // Add the listener for clicks on the footer.\r\n    .then(footer => {\r\n        footer.addEventListener('click', footerClickListener);\r\n        return footer;\r\n    })\r\n    .catch();\r\n};\r\n\r\n/**\r\n * Initialise the keyboard navigation controls for the chooser options.\r\n *\r\n * @method initChooserOptionsKeyboardNavigation\r\n * @param {HTMLElement} body Our modal that we are working with\r\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\r\n * @param {HTMLElement} chooserOptionsContainer The section that contains the chooser items\r\n * @param {Object} modal Our created modal for the section\r\n */\r\nconst initChooserOptionsKeyboardNavigation = (body, mappedModules, chooserOptionsContainer, modal = null) => {\r\n    const chooserOptions = chooserOptionsContainer.querySelectorAll(selectors.regions.chooserOption.container);\r\n\r\n    Array.from(chooserOptions).forEach((element) => {\r\n        return element.addEventListener('keydown', (e) => {\r\n\r\n            // Check for enter/ space triggers for showing the help.\r\n            if (e.keyCode === enter || e.keyCode === space) {\r\n                if (e.target.matches(selectors.actions.optionActions.showSummary)) {\r\n                    e.preventDefault();\r\n                    const module = e.target.closest(selectors.regions.chooserOption.container);\r\n                    const moduleName = module.dataset.modname;\r\n                    const moduleData = mappedModules.get(moduleName);\r\n                    const carousel = $(body.querySelector(selectors.regions.carousel));\r\n                    carousel.carousel({\r\n                        interval: false,\r\n                        pause: true,\r\n                        keyboard: false\r\n                    });\r\n\r\n                    // We need to know if the overall modal has a footer so we know when to show a real / vs fake footer.\r\n                    moduleData.showFooter = modal.hasFooterContent();\r\n                    showModuleHelp(carousel, moduleData, modal);\r\n                }\r\n            }\r\n\r\n            // Next.\r\n            if (e.keyCode === arrowRight) {\r\n                e.preventDefault();\r\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\r\n                const nextOption = currentOption.nextElementSibling;\r\n                const firstOption = chooserOptionsContainer.firstElementChild;\r\n                const toFocusOption = clickErrorHandler(nextOption, firstOption);\r\n                focusChooserOption(toFocusOption, currentOption);\r\n            }\r\n\r\n            // Previous.\r\n            if (e.keyCode === arrowLeft) {\r\n                e.preventDefault();\r\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\r\n                const previousOption = currentOption.previousElementSibling;\r\n                const lastOption = chooserOptionsContainer.lastElementChild;\r\n                const toFocusOption = clickErrorHandler(previousOption, lastOption);\r\n                focusChooserOption(toFocusOption, currentOption);\r\n            }\r\n\r\n            if (e.keyCode === home) {\r\n                e.preventDefault();\r\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\r\n                const firstOption = chooserOptionsContainer.firstElementChild;\r\n                focusChooserOption(firstOption, currentOption);\r\n            }\r\n\r\n            if (e.keyCode === end) {\r\n                e.preventDefault();\r\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\r\n                const lastOption = chooserOptionsContainer.lastElementChild;\r\n                focusChooserOption(lastOption, currentOption);\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * Focus on a chooser option element and remove the previous chooser element from the focus order\r\n *\r\n * @method focusChooserOption\r\n * @param {HTMLElement} currentChooserOption The current chooser option element that we want to focus\r\n * @param {HTMLElement|null} previousChooserOption The previous focused option element\r\n */\r\nconst focusChooserOption = (currentChooserOption, previousChooserOption = null) => {\r\n    if (previousChooserOption !== null) {\r\n        toggleFocusableChooserOption(previousChooserOption, false);\r\n    }\r\n\r\n    toggleFocusableChooserOption(currentChooserOption, true);\r\n    currentChooserOption.focus();\r\n};\r\n\r\n/**\r\n * Add or remove a chooser option from the focus order.\r\n *\r\n * @method toggleFocusableChooserOption\r\n * @param {HTMLElement} chooserOption The chooser option element which should be added or removed from the focus order\r\n * @param {Boolean} isFocusable Whether the chooser element is focusable or not\r\n */\r\nconst toggleFocusableChooserOption = (chooserOption, isFocusable) => {\r\n    const chooserOptionLink = chooserOption.querySelector(selectors.actions.addChooser);\r\n    const chooserOptionHelp = chooserOption.querySelector(selectors.actions.optionActions.showSummary);\r\n    const chooserOptionFavourite = chooserOption.querySelector(selectors.actions.optionActions.manageFavourite);\r\n\r\n    if (isFocusable) {\r\n        // Set tabindex to 0 to add current chooser option element to the focus order.\r\n        chooserOption.tabIndex = 0;\r\n        chooserOptionLink.tabIndex = 0;\r\n        chooserOptionHelp.tabIndex = 0;\r\n        chooserOptionFavourite.tabIndex = 0;\r\n    } else {\r\n        // Set tabindex to -1 to remove the previous chooser option element from the focus order.\r\n        chooserOption.tabIndex = -1;\r\n        chooserOptionLink.tabIndex = -1;\r\n        chooserOptionHelp.tabIndex = -1;\r\n        chooserOptionFavourite.tabIndex = -1;\r\n    }\r\n};\r\n\r\n/**\r\n * Small error handling function to make sure the navigated to object exists\r\n *\r\n * @method clickErrorHandler\r\n * @param {HTMLElement} item What we want to check exists\r\n * @param {HTMLElement} fallback If we dont match anything fallback the focus\r\n * @return {HTMLElement}\r\n */\r\nconst clickErrorHandler = (item, fallback) => {\r\n    if (item !== null) {\r\n        return item;\r\n    } else {\r\n        return fallback;\r\n    }\r\n};\r\n\r\n/**\r\n * Render the search results in a defined container\r\n *\r\n * @method renderSearchResults\r\n * @param {HTMLElement} searchResultsContainer The container where the data should be rendered\r\n * @param {Object} searchResultsData Data containing the module items that satisfy the search criteria\r\n */\r\nconst renderSearchResults = async(searchResultsContainer, searchResultsData) => {\r\n    const templateData = {\r\n        'searchresultsnumber': searchResultsData.length,\r\n        'searchresults': searchResultsData\r\n    };\r\n    // Build up the html & js ready to place into the help section.\r\n    const {html, js} = await Templates.renderForPromise('core_course/local/activitychooser/search_results', templateData);\r\n    await Templates.replaceNodeContents(searchResultsContainer, html, js);\r\n};\r\n\r\n/**\r\n * Toggle (display/hide) the search results depending on the value of the search query\r\n *\r\n * @method toggleSearchResultsView\r\n * @param {Object} modal Our created modal for the section\r\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\r\n * @param {String} searchQuery The search query\r\n */\r\nconst toggleSearchResultsView = async(modal, mappedModules, searchQuery) => {\r\n    const modalBody = modal.getBody()[0];\r\n    const searchResultsContainer = modalBody.querySelector(selectors.regions.searchResults);\r\n    const chooserContainer = modalBody.querySelector(selectors.regions.chooser);\r\n    const clearSearchButton = modalBody.querySelector(selectors.actions.clearSearch);\r\n\r\n    if (searchQuery.length > 0) { // Search query is present.\r\n        const searchResultsData = searchModules(mappedModules, searchQuery);\r\n        await renderSearchResults(searchResultsContainer, searchResultsData);\r\n        const searchResultItemsContainer = searchResultsContainer.querySelector(selectors.regions.searchResultItems);\r\n        const firstSearchResultItem = searchResultItemsContainer.querySelector(selectors.regions.chooserOption.container);\r\n        if (firstSearchResultItem) {\r\n            // Set the first result item to be focusable.\r\n            toggleFocusableChooserOption(firstSearchResultItem, true);\r\n            // Register keyboard events on the created search result items.\r\n            initChooserOptionsKeyboardNavigation(modalBody, mappedModules, searchResultItemsContainer, modal);\r\n        }\r\n        // Display the \"clear\" search button in the activity chooser search bar.\r\n        clearSearchButton.classList.remove('d-none');\r\n        // Hide the default chooser options container.\r\n        chooserContainer.setAttribute('hidden', 'hidden');\r\n        // Display the search results container.\r\n        searchResultsContainer.removeAttribute('hidden');\r\n    } else { // Search query is not present.\r\n        // Hide the \"clear\" search button in the activity chooser search bar.\r\n        clearSearchButton.classList.add('d-none');\r\n        // Hide the search results container.\r\n        searchResultsContainer.setAttribute('hidden', 'hidden');\r\n        // Display the default chooser options container.\r\n        chooserContainer.removeAttribute('hidden');\r\n    }\r\n};\r\n\r\n/**\r\n * Return the list of modules which have a name or description that matches the given search term.\r\n *\r\n * @method searchModules\r\n * @param {Array} modules List of available modules\r\n * @param {String} searchTerm The search term to match\r\n * @return {Array}\r\n */\r\nconst searchModules = (modules, searchTerm) => {\r\n    if (searchTerm === '') {\r\n        return modules;\r\n    }\r\n    searchTerm = searchTerm.toLowerCase();\r\n    const searchResults = [];\r\n    modules.forEach((activity) => {\r\n        const activityName = activity.title.toLowerCase();\r\n        const activityDesc = activity.help.toLowerCase();\r\n        if (activityName.includes(searchTerm) || activityDesc.includes(searchTerm)) {\r\n            searchResults.push(activity);\r\n        }\r\n    });\r\n\r\n    return searchResults;\r\n};\r\n\r\n/**\r\n * Set up our tabindex information across the chooser.\r\n *\r\n * @method setupKeyboardAccessibility\r\n * @param {Promise} modal Our created modal for the section\r\n * @param {Map} mappedModules A map of all of the built module information\r\n */\r\nconst setupKeyboardAccessibility = (modal, mappedModules) => {\r\n    modal.getModal()[0].tabIndex = -1;\r\n\r\n    modal.getBodyPromise().then(body => {\r\n        $(selectors.elements.tab).on('shown.bs.tab', (e) => {\r\n            const activeSectionId = e.target.getAttribute(\"href\");\r\n            const activeSectionChooserOptions = body[0]\r\n                .querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\r\n            const firstChooserOption = activeSectionChooserOptions\r\n                .querySelector(selectors.regions.chooserOption.container);\r\n            const prevActiveSectionId = e.relatedTarget.getAttribute(\"href\");\r\n            const prevActiveSectionChooserOptions = body[0]\r\n                .querySelector(selectors.regions.getSectionChooserOptions(prevActiveSectionId));\r\n\r\n            // Disable the focus of every chooser option in the previous active section.\r\n            disableFocusAllChooserOptions(prevActiveSectionChooserOptions);\r\n            // Enable the focus of the first chooser option in the current active section.\r\n            toggleFocusableChooserOption(firstChooserOption, true);\r\n            initChooserOptionsKeyboardNavigation(body[0], mappedModules, activeSectionChooserOptions, modal);\r\n        });\r\n        return;\r\n    }).catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Disable the focus of all chooser options in a specific container (section).\r\n *\r\n * @method disableFocusAllChooserOptions\r\n * @param {HTMLElement} sectionChooserOptions The section that contains the chooser items\r\n */\r\nconst disableFocusAllChooserOptions = (sectionChooserOptions) => {\r\n    const allChooserOptions = sectionChooserOptions.querySelectorAll(selectors.regions.chooserOption.container);\r\n    allChooserOptions.forEach((chooserOption) => {\r\n        toggleFocusableChooserOption(chooserOption, false);\r\n    });\r\n};\r\n\r\n/**\r\n * Display the module chooser.\r\n *\r\n * @method displayChooser\r\n * @param {Promise} modalPromise Our created modal for the section\r\n * @param {Array} sectionModules An array of all of the built module information\r\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\r\n * @param {Object} footerData Our base footer object.\r\n */\r\nexport const displayChooser = (modalPromise, sectionModules, partialFavourite, footerData) => {\r\n    // Make a map so we can quickly fetch a specific module's object for either rendering or searching.\r\n    const mappedModules = new Map();\r\n    sectionModules.forEach((module) => {\r\n        mappedModules.set(module.componentname + '_' + module.link, module);\r\n    });\r\n\r\n    // Register event listeners.\r\n    modalPromise.then(modal => {\r\n        registerListenerEvents(modal, mappedModules, partialFavourite, footerData);\r\n\r\n        // We want to focus on the first chooser option element as soon as the modal is opened.\r\n        setupKeyboardAccessibility(modal, mappedModules);\r\n\r\n        // We want to focus on the action select when the dialog is closed.\r\n        modal.getRoot().on(ModalEvents.hidden, () => {\r\n            modal.destroy();\r\n        });\r\n\r\n        return modal;\r\n    }).catch();\r\n};\r\n"],"names":["showModuleHelp","carousel","moduleData","modal","showFooter","setFooter","Templates","render","help","find","selectors","regions","innerHTML","classList","add","spinnerPromise","transitionPromiseResolver","transitionPromise","Promise","resolve","contentPromise","renderForPromise","all","then","_ref","html","js","replaceNodeContents","querySelector","chooserSummary","header","focus","catch","Notification","exception","one","registerListenerEvents","mappedModules","partialFavourite","footerData","bodyClickListener","async","e","target","closest","actions","optionActions","showSummary","getBody","moduleName","chooserOption","container","dataset","modname","get","hasFooterContent","manageFavourite","caller","modalBody","isFavourite","favourited","id","name","internal","Repository","unfavouriteModule","favouriteModule","manageFavouriteState","activeSectionId","elements","activetab","getAttribute","sectionChooserOptions","getSectionChooserOptions","firstChooserOption","toggleFocusableChooserOption","initChooserOptionsKeyboardNavigation","matches","closeOption","on","modules","getModuleSelector","clearSearch","searchInput","search","value","toggleSearchResultsView","footerClickListener","footer","footerjs","pluginName","customfooterjs","getBodyPromise","body","interval","pause","keyboard","addEventListener","getFooterPromise","chooserOptionsContainer","chooserOptions","querySelectorAll","Array","from","forEach","element","keyCode","enter","space","preventDefault","arrowRight","currentOption","nextOption","nextElementSibling","firstOption","firstElementChild","toFocusOption","clickErrorHandler","focusChooserOption","arrowLeft","previousOption","previousElementSibling","lastOption","lastElementChild","home","end","currentChooserOption","previousChooserOption","isFocusable","chooserOptionLink","addChooser","chooserOptionHelp","chooserOptionFavourite","tabIndex","item","fallback","searchQuery","searchResultsContainer","searchResults","chooserContainer","chooser","clearSearchButton","length","searchResultsData","searchModules","templateData","renderSearchResults","searchResultItemsContainer","searchResultItems","firstSearchResultItem","remove","setAttribute","removeAttribute","searchTerm","toLowerCase","activity","activityName","title","activityDesc","includes","push","disableFocusAllChooserOptions","modalPromise","sectionModules","Map","module","set","componentname","link","getModal","tab","activeSectionChooserOptions","prevActiveSectionId","relatedTarget","prevActiveSectionChooserOptions","setupKeyboardAccessibility","getRoot","ModalEvents","hidden","destroy"],"mappings":"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"}