{"version":3,"file":"courselist.min.js","sources":["../src/courselist.js"],"sourcesContent":["// Javascript module for courselist page\r\n// Copyright 2018 Howard Miller (howardsmiller@gmail.com)\r\n\r\ndefine(['jquery', 'jqueryui', 'core/config', 'core/ajax', 'core/notification', 'core/templates'],\r\n    function($, jqui, mdlcfg, ajax, notification, templates) {\r\n\r\n    return {\r\n\r\n        init: function(companyid, pathid) {\r\n\r\n\r\n            /**\r\n             * Enable Bootstrap tooltips\r\n             */\r\n            //require(['theme_boost/loader']);\r\n            //require(['theme_boost/tooltip'], function() {\r\n                $('[data-toggle=\"tooltip\"]').tooltip();\r\n            //});\r\n\r\n\r\n            /**\r\n             * Handle response from filter ajax\r\n             * @param array courses - full course objects\r\n             */\r\n            function apply_filter(courses) {\r\n\r\n                // Show/hide 'no courses' message.\r\n                $('#prospectivelist li').remove();\r\n                if (courses.length) {\r\n                    $('#noprospective').hide();\r\n                } else {\r\n                    $('#noprospective').show();\r\n                    return;\r\n                }\r\n\r\n                // Template for course list\r\n                var context = {\r\n                    courses: courses,\r\n                    wwwroot: mdlcfg.wwwroot,\r\n                    prospective: true\r\n                };\r\n//window.alert(\"template prospective list()\");\r\n\r\n                templates.render('local_iomad_learningpath/prospectivelist', context)\r\n                    .done(function(html) {\r\n                        $('#prospectivelist').append(html);\r\n                    })\r\n                    .fail(notification.exception);\r\n            }\r\n\r\n\r\n            /**\r\n             * Setup filter on prospective courses box.\r\n             * @param string filter\r\n             */\r\n            function course_list() {\r\n\r\n                var filter = $('#coursefilter').val();\r\n                var category = $('#category').val();\r\n                var program = $('#program').val();\r\n\r\n//window.alert(\"course_list()\");\r\n//window.alert(program);\r\n\r\n\r\n                // Ajax stuff to get list\r\n                // call the web service\r\n                ajax.call([{\r\n                    methodname: 'local_iomad_learningpath_getprospectivecourses',\r\n                    args: {pathid: pathid, filter: filter, category: category, program: program},\r\n                    done: function(courses) {\r\n/*window.alert(\"apply_filter()\");\r\nwindow.alert(program);\r\n*/\r\n                        apply_filter(courses);\r\n                    },\r\n                    fail: notification.exception,\r\n                }]);\r\n//window.alert(\"course_list() complete\");\r\n            }\r\n\r\n\r\n            /**\r\n             * Bind events for course_list function\r\n             */\r\n            $(window).on('load', course_list());\r\n            $('#program').on('change', function() {\r\n                course_list();\r\n                pathcourse_list();\r\n            });\r\n            $('#coursefilter').on('input', function() {\r\n                course_list();\r\n            });\r\n            $('#category').on('change', function() {\r\n                course_list();\r\n            });\r\n\r\n\r\n\r\n            /**\r\n             * Add hover effect.\r\n             * Bind on ul as li entries are dynamic!\r\n             */\r\n            $('#prospectivelist, .pathcourselist').on('mouseenter', 'li', function() {\r\n                $(this).addClass(\"text-primary\");\r\n            });\r\n            $('#prospectivelist, .pathcourselist').on('mouseleave', 'li', function() {\r\n                $(this).removeClass(\"text-primary\");\r\n            });\r\n\r\n\r\n            /**\r\n             * Handle response from add/display selected courses\r\n             * @param object pcl - the selected list (= group)\r\n             * @param array courses - full course objects\r\n             */\r\n            function apply_pathcourses(pcl, courses) {\r\n\r\n                // Show/hide 'no courses' message.\r\n                $(pcl).find('li').remove();\r\n                var groupid = $(pcl).data('groupid');\r\n                var nogroupcourses = $(\".nogroupcourses[data-groupid='\" + groupid + \"']\");\r\n                if (courses.length) {\r\n                    nogroupcourses.hide();\r\n                } else {\r\n                    nogroupcourses.show();\r\n                    return;\r\n                }\r\n\r\n                // Template for course list\r\n                var context = {\r\n                    courses: courses,\r\n                    wwwroot: mdlcfg.wwwroot,\r\n                    prospective: false\r\n                };\r\n//window.alert(\"template apply pathcourses\");\r\n\r\n                templates.render('local_iomad_learningpath/pathcourselist', context)\r\n                    .done(function(html) {\r\n                        $(pcl).append(html);\r\n                    })\r\n                    .fail(notification.exception);\r\n            }\r\n\r\n\r\n            /*\r\n             * Populate pathcourse list\r\n             * @param string filter\r\n             */\r\n            function pathcourse_list() {\r\n\r\n//window.alert(\"pathcourse_list()\");\r\n\r\n                // Ajax stuff to get list\r\n                // call the web service\r\n                $(\".pathcourselist\").each(function() {\r\n                    var pcl = this;\r\n                    var groupid = $(pcl).data('groupid');\r\n                    ajax.call([{\r\n                        methodname: 'local_iomad_learningpath_getcourses',\r\n                        args: {pathid: pathid, groupid: groupid},\r\n                        done: function(courses) {\r\n//window.alert(\"apply_pathcourses()\");\r\n                            apply_pathcourses(pcl, courses);\r\n                        },\r\n                        fail: notification.exception,\r\n                    }]);\r\n                });\r\n            }\r\n\r\n\r\n            /**\r\n             * Bind events for user_list function\r\n             */\r\n            $(window).on('load', pathcourse_list());\r\n\r\n\r\n            /**\r\n             * Add click handler for adding course\r\n             */\r\n            $('#prospectivelist').on('click', '.path-add', function() {\r\n                var courseid = $(this).data('courseid');\r\n\r\n                // Add the course to the path\r\n                ajax.call([{\r\n                    methodname: 'local_iomad_learningpath_addcourses',\r\n                    args: {pathid: pathid, courseids: [courseid]},\r\n                    done: function() {\r\n                        pathcourse_list();\r\n                        course_list();\r\n                    },\r\n                    fail: notification.exception,\r\n                }]);\r\n            });\r\n\r\n\r\n            /**\r\n             * Add click handler for removing course\r\n             */\r\n            $('.pathcourselist').on('click', '.path-delete', function() {\r\n                var courseid = $(this).data('courseid');\r\n\r\n                // Remove the course from the path\r\n                ajax.call([{\r\n                    methodname: 'local_iomad_learningpath_removecourses',\r\n                    args: {pathid: pathid, courseids: [courseid]},\r\n                    done: function() {\r\n                        pathcourse_list();\r\n                        course_list();\r\n                    },\r\n                    fail: notification.exception\r\n                }]);\r\n            });\r\n\r\n\r\n            /**\r\n             * Fix plus/trash icons so they are correct for the list they are in\r\n             */\r\n            function fix_icons() {\r\n                $(\"#prospectivelist .path-delete\").removeClass('fa-trash path-delete').addClass('fa-plus path-add');\r\n                $(\".pathcourselist .path-add\").removeClass('fa-plus path-add').addClass('fa-trash path-delete');\r\n            }\r\n\r\n\r\n            /**\r\n             * Sort added courses list into order\r\n             */\r\n            $(\".pathcourselist\").sortable({\r\n                handle: '.lphandle',\r\n                connectWith: '#prospectivelist, .pathcourselist',\r\n                dropOnEmpty: true,\r\n                update: function() {\r\n\r\n                    // Get already selected courseids\r\n                    var courses = [];\r\n                    $(\".pathcourselist .pathbox\").each(function() {\r\n                        var courseid = $(this).data('courseid');\r\n                        var groupid = $(this).parent().parent().data('groupid');\r\n                        courses.push({courseid: courseid, groupid: groupid});\r\n                    });\r\n\r\n                    // Reorder\r\n                    ajax.call([{\r\n                        methodname: 'local_iomad_learningpath_ordercourses',\r\n                        args: {pathid: pathid, courses: courses},\r\n                        done: function() {},\r\n                        fail: notification.exception\r\n                    }]);\r\n\r\n                    fix_icons();\r\n                }\r\n            });\r\n\r\n            /**\r\n             * Permit drag to add\r\n             */\r\n            $('#prospectivelist').sortable({\r\n                handle: '.lphandle',\r\n                connectWith: '.pathcourselist',\r\n                dropOnEmpty: true,\r\n                update: function() {\r\n                    fix_icons();\r\n                }\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n});\r\n"],"names":["define","$","jqui","mdlcfg","ajax","notification","templates","init","companyid","pathid","course_list","filter","val","category","program","call","methodname","args","done","courses","remove","length","hide","context","wwwroot","prospective","render","html","append","fail","exception","show","apply_filter","pathcourse_list","each","pcl","this","groupid","data","find","nogroupcourses","apply_pathcourses","fix_icons","removeClass","addClass","tooltip","window","on","courseid","courseids","sortable","handle","connectWith","dropOnEmpty","update","parent","push"],"mappings":"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"}