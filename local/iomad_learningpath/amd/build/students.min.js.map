{"version":3,"file":"students.min.js","sources":["../src/students.js"],"sourcesContent":["// Javascript module for courselist page\r\n// Copyright 2018 Howard Miller (howardsmiller@gmail.com)\r\n\r\ndefine(['jquery', 'jqueryui', 'core/config', 'core/ajax', 'core/notification'], function($, jqui, mdlcfg, ajax, notification) {\r\n\r\n    return {\r\n\r\n        init: function(companyid, pathid) {\r\n\r\n\r\n            /**\r\n             * Handle response from filter ajax\r\n             * @param array users\r\n             */\r\n            function apply_filter(users) {\r\n\r\n                // Check if there are any students\r\n                $('#prospectivelist li').remove();\r\n                if (users.length) {\r\n                    $('#noprospective').hide();\r\n                } else {\r\n                    $('#noprospective').show();\r\n                    $('#toomanyprospective').hide();\r\n                    return;\r\n                }\r\n\r\n                // Check if there are too many students\r\n                if (users.length > 30) {\r\n                    $('#toomanyprospective').show();\r\n                    return;\r\n                } else {\r\n                    $('#toomanyprospective').hide();\r\n                }\r\n\r\n                // Display updated list.\r\n                var items = [];\r\n                $.each(users, function(id, user) {\r\n                    items.push('<li class=\"text-truncate\" data-userid=\"' + user.id +\r\n                        '\"><i class=\"fa fa-user\"></i> ' + user.fullname + '</li>');\r\n                });\r\n                $('#prospectivelist').append(items.join(''));\r\n            }\r\n\r\n\r\n            /*\r\n             * Populate/filter user list\r\n             * @param string filter\r\n             */\r\n            function user_list() {\r\n\r\n                var filter = $('#userfilter').val();\r\n                var profilefieldid = $('#profilefieldid').val();\r\n\r\n                // Ajax stuff to get list\r\n                // call the web service\r\n                ajax.call([{\r\n                    methodname: 'local_iomad_learningpath_getprospectiveusers',\r\n                    args: {companyid: companyid, pathid: pathid, filter: filter, profilefieldid: profilefieldid},\r\n                    done: function(users) {\r\n                        apply_filter(users);\r\n                    },\r\n                    fail: notification.exception,\r\n                }]);\r\n            }\r\n\r\n            /**\r\n             * Bind events for user_list function\r\n             */\r\n            $(window).on('load', user_list(''));\r\n            $('#userfilter').on('input', function() {\r\n                user_list();\r\n            });\r\n            $('#profilefieldid').on('change', function() {\r\n                user_list();\r\n            });\r\n\r\n\r\n            /**\r\n             * Add hover effect.\r\n             * Bind on ul as li entries are dynamic!\r\n             */\r\n            $('#prospectivelist, #pathuserlist').on('mouseenter', 'li', function() {\r\n                $(this).addClass(\"text-primary\");\r\n            });\r\n            $('#prospectivelist, #pathuserlist').on('mouseleave', 'li', function() {\r\n                $(this).removeClass(\"text-primary\");\r\n            });\r\n\r\n\r\n            /**\r\n             * Handle response from add/display path users\r\n             * @param array users\r\n             */\r\n            function apply_pathusers(users) {\r\n\r\n                // Check if there are any users\r\n                $('#pathuserlist li').remove();\r\n                if (users.length) {\r\n                    $('#nopathusers').hide();\r\n                } else {\r\n                    $('#nopathusers').show();\r\n                    return;\r\n                }\r\n\r\n                var items = [];\r\n                $.each(users, function(id, user) {\r\n                    items.push('<li class=\"text-truncate\" data-userid=\"' + user.id +\r\n                        '\"><i class=\"fa fa-user\"></i> ' + user.fullname + '</li>');\r\n                });\r\n                $('#pathuserlist').append(items.join(''));\r\n            }\r\n\r\n\r\n            /*\r\n             * Populate pathuser list\r\n             * @param string filter\r\n             */\r\n            function pathuser_list() {\r\n\r\n                // Ajax stuff to get list\r\n                // call the web service\r\n                ajax.call([{\r\n                    methodname: 'local_iomad_learningpath_getusers',\r\n                    args: {companyid: companyid, pathid: pathid},\r\n                    done: function(users) {\r\n                        apply_pathusers(users);\r\n                    },\r\n                    fail: notification.exception,\r\n                }]);\r\n            }\r\n\r\n\r\n            /**\r\n             * Bind events for user_list function\r\n             */\r\n            $(window).on('load', pathuser_list());\r\n\r\n\r\n            /**\r\n             * Add click handler for adding user\r\n             * (bind on list as li's are dynamic)\r\n             */\r\n            $('#prospectivelist').on('click', 'li', function() {\r\n                var userid = $(this).data('userid');\r\n\r\n                // Add the user to the path\r\n                ajax.call([{\r\n                    methodname: 'local_iomad_learningpath_addusers',\r\n                    args: {pathid: pathid, userids: [userid]},\r\n                    done: function() {\r\n                        pathuser_list();\r\n                        user_list();\r\n                    },\r\n                    fail: notification.exception,\r\n                }]);\r\n            });\r\n\r\n\r\n            /**\r\n             * Add click handler for removing user\r\n             */\r\n            $('#pathuserlist').on('click', 'li', function() {\r\n                var userid = $(this).data('userid');\r\n\r\n                // Remove the course from the path\r\n                ajax.call([{\r\n                    methodname: 'local_iomad_learningpath_removeusers',\r\n                    args: {pathid: pathid, userids: [userid]},\r\n                    done: function() {\r\n\r\n                        // Update list\r\n                        pathuser_list();\r\n                        user_list();\r\n                    },\r\n                    fail: notification.exception\r\n                }]);\r\n            });\r\n\r\n\r\n\r\n        }\r\n    };\r\n\r\n});\r\n"],"names":["define","$","jqui","mdlcfg","ajax","notification","init","companyid","pathid","user_list","filter","val","profilefieldid","call","methodname","args","done","users","remove","length","show","hide","items","each","id","user","push","fullname","append","join","apply_filter","fail","exception","pathuser_list","apply_pathusers","window","on","this","addClass","removeClass","userid","data","userids"],"mappings":"AAGAA,2CAAO,CAAC,SAAU,WAAY,cAAe,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,OAAQC,KAAMC,oBAErG,CAEHC,KAAM,SAASC,UAAWC,iBAyCbC,gBAEDC,OAAST,EAAE,eAAeU,MAC1BC,eAAiBX,EAAE,mBAAmBU,MAI1CP,KAAKS,KAAK,CAAC,CACPC,WAAY,+CACZC,KAAM,CAACR,UAAWA,UAAWC,OAAQA,OAAQE,OAAQA,OAAQE,eAAgBA,gBAC7EI,KAAM,SAASC,iBA5CDA,UAGlBhB,EAAE,uBAAuBiB,UACrBD,MAAME,cAGNlB,EAAE,kBAAkBmB,YACpBnB,EAAE,uBAAuBoB,UAHzBpB,EAAE,kBAAkBoB,OAQpBJ,MAAME,OAAS,GACflB,EAAE,uBAAuBmB,YAGzBnB,EAAE,uBAAuBoB,WAIzBC,MAAQ,GACZrB,EAAEsB,KAAKN,OAAO,SAASO,GAAIC,MACvBH,MAAMI,KAAK,0CAA4CD,KAAKD,GACxD,gCAAkCC,KAAKE,SAAW,YAE1D1B,EAAE,oBAAoB2B,OAAON,MAAMO,KAAK,MAmBhCC,CAAab,QAEjBc,KAAM1B,aAAa2B,sBAwDlBC,gBAIL7B,KAAKS,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CAACR,UAAWA,UAAWC,OAAQA,QACrCQ,KAAM,SAASC,iBA/BEA,UAGrBhB,EAAE,oBAAoBiB,SAClBD,MAAME,QACNlB,EAAE,gBAAgBoB,WAMlBC,MAAQ,GACZrB,EAAEsB,KAAKN,OAAO,SAASO,GAAIC,MACvBH,MAAMI,KAAK,0CAA4CD,KAAKD,GACxD,gCAAkCC,KAAKE,SAAW,YAE1D1B,EAAE,iBAAiB2B,OAAON,MAAMO,KAAK,UATjC5B,EAAE,gBAAgBmB,OAyBdc,CAAgBjB,QAEpBc,KAAM1B,aAAa2B,aA3D3B/B,EAAEkC,QAAQC,GAAG,OAAQ3B,aACrBR,EAAE,eAAemC,GAAG,SAAS,WACzB3B,eAEJR,EAAE,mBAAmBmC,GAAG,UAAU,WAC9B3B,eAQJR,EAAE,mCAAmCmC,GAAG,aAAc,MAAM,WACxDnC,EAAEoC,MAAMC,SAAS,mBAErBrC,EAAE,mCAAmCmC,GAAG,aAAc,MAAM,WACxDnC,EAAEoC,MAAME,YAAY,mBAkDxBtC,EAAEkC,QAAQC,GAAG,OAAQH,iBAOrBhC,EAAE,oBAAoBmC,GAAG,QAAS,MAAM,eAChCI,OAASvC,EAAEoC,MAAMI,KAAK,UAG1BrC,KAAKS,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CAACP,OAAQA,OAAQkC,QAAS,CAACF,SACjCxB,KAAM,WACFiB,gBACAxB,aAEJsB,KAAM1B,aAAa2B,gBAQ3B/B,EAAE,iBAAiBmC,GAAG,QAAS,MAAM,eAC7BI,OAASvC,EAAEoC,MAAMI,KAAK,UAG1BrC,KAAKS,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CAACP,OAAQA,OAAQkC,QAAS,CAACF,SACjCxB,KAAM,WAGFiB,gBACAxB,aAEJsB,KAAM1B,aAAa2B"}