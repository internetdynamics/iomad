{"version":3,"file":"view_manager.min.js","sources":["../src/view_manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * A javascript module to handler calendar view changes.\r\n *\r\n * @module     core_calendar/view_manager\r\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\nimport * as CalendarRepository from 'core_calendar/repository';\r\nimport CalendarEvents from 'core_calendar/events';\r\nimport * as CalendarSelectors from 'core_calendar/selectors';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport SummaryModal from 'core_calendar/summary_modal';\r\nimport CustomEvents from 'core/custom_interaction_events';\r\nimport {get_string as getString} from 'core/str';\r\nimport Pending from 'core/pending';\r\nimport {prefetchStrings} from 'core/prefetch';\r\n\r\n/**\r\n * Limit number of events per day\r\n *\r\n */\r\nconst LIMIT_DAY_EVENTS = 5;\r\n\r\n/**\r\n * Hide day events if more than 5.\r\n *\r\n */\r\nexport const foldDayEvents = () => {\r\n    const root = $(CalendarSelectors.elements.monthDetailed);\r\n    const days = root.find(CalendarSelectors.day);\r\n    if (days.length === 0) {\r\n        return;\r\n    }\r\n    days.each(function() {\r\n        const dayContainer = $(this);\r\n        const eventsSelector = `${CalendarSelectors.elements.dateContent} ul li[data-event-eventtype]`;\r\n        const filteredEventsSelector = `${CalendarSelectors.elements.dateContent} ul li[data-event-filtered=\"true\"]`;\r\n        const moreEventsSelector = `${CalendarSelectors.elements.dateContent} [data-action=\"view-more-events\"]`;\r\n        const events = dayContainer.find(eventsSelector);\r\n        if (events.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const filteredEvents = dayContainer.find(filteredEventsSelector);\r\n        const numberOfFiltered = filteredEvents.length;\r\n        const numberOfEvents = events.length - numberOfFiltered;\r\n\r\n        let count = 1;\r\n        events.each(function() {\r\n            const event = $(this);\r\n            const isNotFiltered = event.attr('data-event-filtered') !== 'true';\r\n            const offset = (numberOfEvents === LIMIT_DAY_EVENTS) ? 0 : 1;\r\n            if (isNotFiltered) {\r\n                if (count > LIMIT_DAY_EVENTS - offset) {\r\n                    event.attr('data-event-folded', 'true');\r\n                    event.hide();\r\n                } else {\r\n                    event.attr('data-event-folded', 'false');\r\n                    event.show();\r\n                    count++;\r\n                }\r\n            } else {\r\n                // It's being filtered out.\r\n                event.attr('data-event-folded', 'false');\r\n            }\r\n        });\r\n\r\n        const moreEventsLink = dayContainer.find(moreEventsSelector);\r\n        if (numberOfEvents > LIMIT_DAY_EVENTS) {\r\n            const numberOfHiddenEvents = numberOfEvents - LIMIT_DAY_EVENTS + 1;\r\n            moreEventsLink.show();\r\n            getString('moreevents', 'calendar', numberOfHiddenEvents).then(str => {\r\n                const link = moreEventsLink.find('strong a');\r\n                moreEventsLink.attr('data-event-folded', 'false');\r\n                link.text(str);\r\n                return str;\r\n            }).fail();\r\n        } else {\r\n            moreEventsLink.hide();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Register and handle month calendar events.\r\n *\r\n * @param {string} pendingId pending id.\r\n */\r\nexport const registerEventListenersForMonthDetailed = (pendingId) => {\r\n    const events = `${CalendarEvents.viewUpdated}`;\r\n    $('body').on(events, function(e) {\r\n        foldDayEvents(e);\r\n    });\r\n    foldDayEvents();\r\n    $('body').on(CalendarEvents.filterChanged, function(e, data) {\r\n        const root = $(CalendarSelectors.elements.monthDetailed);\r\n        const pending = new Pending(pendingId);\r\n        const target = root.find(CalendarSelectors.eventType[data.type]);\r\n        const transitionPromise = $.Deferred();\r\n        if (data.hidden) {\r\n            transitionPromise.then(function() {\r\n                target.attr('data-event-filtered', 'true');\r\n                return target.hide().promise();\r\n            }).fail();\r\n        } else {\r\n            transitionPromise.then(function() {\r\n                target.attr('data-event-filtered', 'false');\r\n                return target.show().promise();\r\n            }).fail();\r\n        }\r\n\r\n        transitionPromise.then(function() {\r\n            foldDayEvents();\r\n            return;\r\n        })\r\n        .always(pending.resolve)\r\n        .fail();\r\n\r\n        transitionPromise.resolve();\r\n    });\r\n};\r\n\r\n/**\r\n * Register event listeners for the module.\r\n *\r\n * @param {object} root The root element.\r\n */\r\nconst registerEventListeners = (root) => {\r\n    root = $(root);\r\n\r\n    // Bind click events to event links.\r\n    root.on('click', CalendarSelectors.links.eventLink, (e) => {\r\n        const target = e.target;\r\n        let eventLink = null;\r\n        let eventId = null;\r\n        const pendingPromise = new Pending('core_calendar/view_manager:eventLink:click');\r\n\r\n        if (target.matches(CalendarSelectors.actions.viewEvent)) {\r\n            eventLink = target;\r\n        } else {\r\n            eventLink = target.closest(CalendarSelectors.actions.viewEvent);\r\n        }\r\n\r\n        if (eventLink) {\r\n            eventId = eventLink.dataset.eventId;\r\n        } else {\r\n            eventId = target.querySelector(CalendarSelectors.actions.viewEvent).dataset.eventId;\r\n        }\r\n\r\n        if (eventId) {\r\n            // A link was found. Show the modal.\r\n\r\n            e.preventDefault();\r\n            // We've handled the event so stop it from bubbling\r\n            // and causing the day click handler to fire.\r\n            e.stopPropagation();\r\n\r\n            renderEventSummaryModal(eventId)\r\n            .then(pendingPromise.resolve)\r\n            .catch();\r\n        } else {\r\n            pendingPromise.resolve();\r\n        }\r\n    });\r\n\r\n    root.on('click', CalendarSelectors.links.navLink, (e) => {\r\n        const wrapper = root.find(CalendarSelectors.wrapper);\r\n        const view = wrapper.data('view');\r\n        const courseId = wrapper.data('courseid');\r\n        const categoryId = wrapper.data('categoryid');\r\n        const link = e.currentTarget;\r\n\r\n        if (view === 'month' || view === 'monthblock') {\r\n            changeMonth(root, link.href, link.dataset.year, link.dataset.month, courseId, categoryId, link.dataset.day);\r\n            e.preventDefault();\r\n        } else if (view === 'day') {\r\n            changeDay(root, link.href, link.dataset.year, link.dataset.month, link.dataset.day, courseId, categoryId);\r\n            e.preventDefault();\r\n        }\r\n    });\r\n\r\n    const viewSelector = root.find(CalendarSelectors.viewSelector);\r\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\r\n    viewSelector.on(\r\n        CustomEvents.events.activate,\r\n        (e) => {\r\n            e.preventDefault();\r\n\r\n            const option = e.target;\r\n            if (option.classList.contains('active')) {\r\n                return;\r\n            }\r\n\r\n            const view = option.dataset.view,\r\n                year = option.dataset.year,\r\n                month = option.dataset.month,\r\n                day = option.dataset.day,\r\n                courseId = option.dataset.courseid,\r\n                categoryId = option.dataset.categoryid;\r\n\r\n            if (view == 'month') {\r\n                refreshMonthContent(root, year, month, courseId, categoryId, root, 'core_calendar/calendar_month', day)\r\n                    .then(() => {\r\n                        updateUrl('?view=month');\r\n                    }).fail(Notification.exception);\r\n            } else if (view == 'day') {\r\n                refreshDayContent(root, year, month, day, courseId, categoryId, root, 'core_calendar/calendar_day')\r\n                    .then(() => {\r\n                        updateUrl('?view=day');\r\n                    }).fail(Notification.exception);\r\n            } else if (view == 'upcoming') {\r\n                reloadCurrentUpcoming(root, courseId, categoryId, root, 'core_calendar/calendar_upcoming')\r\n                    .then(() => {\r\n                        updateUrl('?view=upcoming');\r\n                    }).fail(Notification.exception);\r\n            }\r\n        }\r\n    );\r\n};\r\n\r\n/**\r\n * Refresh the month content.\r\n *\r\n * @param {object} root The root element.\r\n * @param {number} year Year\r\n * @param {number} month Month\r\n * @param {number} courseId The id of the course whose events are shown\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\r\n * @param {string} template The template to be rendered.\r\n * @param {number} day Day (optional)\r\n * @return {promise}\r\n */\r\nexport const refreshMonthContent = (root, year, month, courseId, categoryId, target = null, template = '', day = 1) => {\r\n    startLoading(root);\r\n\r\n    target = target || root.find(CalendarSelectors.wrapper);\r\n    template = template || root.attr('data-template');\r\n    M.util.js_pending([root.get('id'), year, month, courseId].join('-'));\r\n    const includenavigation = root.data('includenavigation');\r\n    const mini = root.data('mini');\r\n    const viewMode = target.data('view');\r\n    return CalendarRepository.getCalendarMonthData(year, month, courseId, categoryId, includenavigation, mini, day, viewMode)\r\n        .then(context => {\r\n            return Templates.render(template, context);\r\n        })\r\n        .then((html, js) => {\r\n            return Templates.replaceNode(target, html, js);\r\n        })\r\n        .then(() => {\r\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\r\n            return;\r\n        })\r\n        .always(() => {\r\n            M.util.js_complete([root.get('id'), year, month, courseId].join('-'));\r\n            return stopLoading(root);\r\n        })\r\n        .fail(Notification.exception);\r\n};\r\n\r\n/**\r\n * Handle changes to the current calendar view.\r\n *\r\n * @param {object} root The container element\r\n * @param {string} url The calendar url to be shown\r\n * @param {number} year Year\r\n * @param {number} month Month\r\n * @param {number} courseId The id of the course whose events are shown\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {number} day Day (optional)\r\n * @return {promise}\r\n */\r\nexport const changeMonth = (root, url, year, month, courseId, categoryId, day = 1) => {\r\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day)\r\n        .then((...args) => {\r\n            if (url.length && url !== '#') {\r\n                updateUrl(url);\r\n            }\r\n            return args;\r\n        })\r\n        .then((...args) => {\r\n            $('body').trigger(CalendarEvents.monthChanged, [year, month, courseId, categoryId]);\r\n            return args;\r\n        });\r\n};\r\n\r\n/**\r\n * Reload the current month view data.\r\n *\r\n * @param {object} root The container element.\r\n * @param {number} courseId The course id.\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @return {promise}\r\n */\r\nexport const reloadCurrentMonth = (root, courseId = 0, categoryId = 0) => {\r\n    const year = root.find(CalendarSelectors.wrapper).data('year');\r\n    const month = root.find(CalendarSelectors.wrapper).data('month');\r\n    const day = root.find(CalendarSelectors.wrapper).data('day');\r\n\r\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\r\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\r\n\r\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day).\r\n        then((...args) => {\r\n            $('body').trigger(CalendarEvents.courseChanged, [year, month, courseId, categoryId]);\r\n            return args;\r\n        });\r\n};\r\n\r\n\r\n/**\r\n * Refresh the day content.\r\n *\r\n * @param {object} root The root element.\r\n * @param {number} year Year\r\n * @param {number} month Month\r\n * @param {number} day Day\r\n * @param {number} courseId The id of the course whose events are shown\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\r\n * @param {string} template The template to be rendered.\r\n *\r\n * @return {promise}\r\n */\r\nexport const refreshDayContent = (root, year, month, day, courseId, categoryId, target = null, template = '') => {\r\n    startLoading(root);\r\n\r\n    if (!target || target.length == 0){\r\n        target = root.find(CalendarSelectors.wrapper);\r\n    }\r\n    template = template || root.attr('data-template');\r\n    M.util.js_pending([root.get('id'), year, month, day, courseId, categoryId].join('-'));\r\n    const includenavigation = root.data('includenavigation');\r\n    return CalendarRepository.getCalendarDayData(year, month, day, courseId, categoryId, includenavigation)\r\n        .then((context) => {\r\n            context.viewingday = true;\r\n            context.showviewselector = true;\r\n            return Templates.render(template, context);\r\n        })\r\n        .then((html, js) => {\r\n            return Templates.replaceNode(target, html, js);\r\n        })\r\n        .then(() => {\r\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\r\n            return;\r\n        })\r\n        .always(() => {\r\n            M.util.js_complete([root.get('id'), year, month, day, courseId, categoryId].join('-'));\r\n            return stopLoading(root);\r\n        })\r\n        .fail(Notification.exception);\r\n};\r\n\r\n/**\r\n * Reload the current day view data.\r\n *\r\n * @param {object} root The container element.\r\n * @param {number} courseId The course id.\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @return {promise}\r\n */\r\nexport const reloadCurrentDay = (root, courseId = 0, categoryId = 0) => {\r\n    const wrapper = root.find(CalendarSelectors.wrapper);\r\n    const year = wrapper.data('year');\r\n    const month = wrapper.data('month');\r\n    const day = wrapper.data('day');\r\n\r\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\r\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\r\n\r\n    return refreshDayContent(root, year, month, day, courseId, categoryId);\r\n};\r\n\r\n/**\r\n * Handle changes to the current calendar view.\r\n *\r\n * @param {object} root The root element.\r\n * @param {String} url The calendar url to be shown\r\n * @param {Number} year Year\r\n * @param {Number} month Month\r\n * @param {Number} day Day\r\n * @param {Number} courseId The id of the course whose events are shown\r\n * @param {Number} categoryId The id of the category whose events are shown\r\n * @return {promise}\r\n */\r\nexport const changeDay = (root, url, year, month, day, courseId, categoryId) => {\r\n    return refreshDayContent(root, year, month, day, courseId, categoryId)\r\n        .then((...args) => {\r\n            if (url.length && url !== '#') {\r\n                updateUrl(url);\r\n            }\r\n            return args;\r\n        })\r\n        .then((...args) => {\r\n            $('body').trigger(CalendarEvents.dayChanged, [year, month, courseId, categoryId]);\r\n            return args;\r\n        });\r\n};\r\n\r\n/**\r\n * Update calendar URL.\r\n *\r\n * @param {String} url The calendar url to be updated.\r\n */\r\nexport const updateUrl = (url) => {\r\n    const viewingFullCalendar = document.getElementById(CalendarSelectors.fullCalendarView);\r\n\r\n    // We want to update the url only if the user is viewing the full calendar.\r\n    if (viewingFullCalendar) {\r\n        window.history.pushState({}, '', url);\r\n    }\r\n};\r\n\r\n/**\r\n * Set the element state to loading.\r\n *\r\n * @param {object} root The container element\r\n * @method startLoading\r\n */\r\nconst startLoading = (root) => {\r\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\r\n\r\n    loadingIconContainer.removeClass('hidden');\r\n};\r\n\r\n/**\r\n * Remove the loading state from the element.\r\n *\r\n * @param {object} root The container element\r\n * @method stopLoading\r\n */\r\nconst stopLoading = (root) => {\r\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\r\n\r\n    loadingIconContainer.addClass('hidden');\r\n};\r\n\r\n/**\r\n * Reload the current month view data.\r\n *\r\n * @param {object} root The container element.\r\n * @param {number} courseId The course id.\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\r\n * @param {string} template The template to be rendered.\r\n * @return {promise}\r\n */\r\nexport const reloadCurrentUpcoming = (root, courseId = 0, categoryId = 0, target = null, template = '') => {\r\n    startLoading(root);\r\n\r\n    target = target || root.find(CalendarSelectors.wrapper);\r\n    template = template || root.attr('data-template');\r\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\r\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\r\n\r\n    return CalendarRepository.getCalendarUpcomingData(courseId, categoryId)\r\n        .then((context) => {\r\n            context.viewingupcoming = true;\r\n            context.showviewselector = true;\r\n            return Templates.render(template, context);\r\n        })\r\n        .then((html, js) => {\r\n            return Templates.replaceNode(target, html, js);\r\n        })\r\n        .then(() => {\r\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\r\n            return;\r\n        })\r\n        .always(function() {\r\n            return stopLoading(root);\r\n        })\r\n        .fail(Notification.exception);\r\n};\r\n\r\n/**\r\n * Get the CSS class to apply for the given event type.\r\n *\r\n * @param {string} eventType The calendar event type\r\n * @return {string}\r\n */\r\nconst getEventTypeClassFromType = (eventType) => {\r\n    return 'calendar_event_' + eventType;\r\n};\r\n\r\n/**\r\n * Render the event summary modal.\r\n *\r\n * @param {Number} eventId The calendar event id.\r\n * @returns {Promise}\r\n */\r\nconst renderEventSummaryModal = (eventId) => {\r\n    const pendingPromise = new Pending('core_calendar/view_manager:renderEventSummaryModal');\r\n\r\n    // Calendar repository promise.\r\n    return CalendarRepository.getEventById(eventId)\r\n    .then((getEventResponse) => {\r\n        if (!getEventResponse.event) {\r\n            throw new Error('Error encountered while trying to fetch calendar event with ID: ' + eventId);\r\n        }\r\n\r\n        return getEventResponse.event;\r\n    })\r\n    .then(eventData => {\r\n        // Build the modal parameters from the event data.\r\n        const modalParams = {\r\n            title: eventData.name,\r\n            type: SummaryModal.TYPE,\r\n            body: Templates.render('core_calendar/event_summary_body', eventData),\r\n            templateContext: {\r\n                canedit: eventData.canedit,\r\n                candelete: eventData.candelete,\r\n                headerclasses: getEventTypeClassFromType(eventData.normalisedeventtype),\r\n                isactionevent: eventData.isactionevent,\r\n                url: eventData.url,\r\n                action: eventData.action\r\n            }\r\n        };\r\n\r\n        // Create the modal.\r\n        return ModalFactory.create(modalParams);\r\n    })\r\n    .then(modal => {\r\n        // Handle hidden event.\r\n        modal.getRoot().on(ModalEvents.hidden, function() {\r\n            // Destroy when hidden.\r\n            modal.destroy();\r\n        });\r\n\r\n        // Finally, render the modal!\r\n        modal.show();\r\n\r\n        return modal;\r\n    })\r\n    .then(modal => {\r\n        pendingPromise.resolve();\r\n\r\n        return modal;\r\n    })\r\n    .catch(Notification.exception);\r\n};\r\n\r\nexport const init = (root, view) => {\r\n    prefetchStrings('calendar', ['moreevents']);\r\n    foldDayEvents();\r\n    registerEventListeners(root, view);\r\n    const calendarTable = root.find(CalendarSelectors.elements.monthDetailed);\r\n    if (calendarTable.length) {\r\n        const pendingId = `month-detailed-${calendarTable.id}-filterChanged`;\r\n        registerEventListenersForMonthDetailed(calendarTable, pendingId);\r\n    }\r\n};\r\n"],"names":["foldDayEvents","days","CalendarSelectors","elements","monthDetailed","find","day","length","each","dayContainer","this","eventsSelector","dateContent","filteredEventsSelector","moreEventsSelector","events","numberOfFiltered","numberOfEvents","count","event","attr","hide","show","moreEventsLink","numberOfHiddenEvents","then","str","link","text","fail","registerEventListenersForMonthDetailed","pendingId","CalendarEvents","viewUpdated","on","e","filterChanged","data","root","pending","Pending","target","eventType","type","transitionPromise","$","Deferred","hidden","promise","always","resolve","refreshMonthContent","year","month","courseId","categoryId","template","startLoading","wrapper","M","util","js_pending","get","join","includenavigation","mini","viewMode","CalendarRepository","getCalendarMonthData","context","Templates","render","html","js","replaceNode","document","querySelector","dispatchEvent","CustomEvent","js_complete","stopLoading","Notification","exception","changeMonth","url","updateUrl","args","trigger","monthChanged","courseChanged","refreshDayContent","getCalendarDayData","viewingday","showviewselector","changeDay","dayChanged","getElementById","fullCalendarView","window","history","pushState","containers","loadingIcon","removeClass","addClass","reloadCurrentUpcoming","getCalendarUpcomingData","viewingupcoming","renderEventSummaryModal","eventId","pendingPromise","getEventById","getEventResponse","Error","eventData","modalParams","title","name","SummaryModal","TYPE","body","templateContext","canedit","candelete","headerclasses","normalisedeventtype","isactionevent","action","ModalFactory","create","modal","getRoot","ModalEvents","destroy","catch","view","links","eventLink","matches","actions","viewEvent","closest","dataset","preventDefault","stopPropagation","navLink","currentTarget","href","viewSelector","define","CustomEvents","activate","option","classList","contains","courseid","categoryid","registerEventListeners","calendarTable","id"],"mappings":"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"}