{"version":3,"file":"calendar_threemonth.min.js","sources":["../src/calendar_threemonth.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This module handles display of multiple mini calendars in a view, and\r\n * movement through them.\r\n *\r\n * @deprecated since 4.0 MDL-72810.\r\n * @todo       MDL-73117 This will be deleted in Moodle 4.4.\r\n * @module     core_calendar/calendar_threemonth\r\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/notification',\r\n    'core_calendar/selectors',\r\n    'core_calendar/events',\r\n    'core/templates',\r\n    'core_calendar/view_manager',\r\n],\r\nfunction(\r\n    $,\r\n    Notification,\r\n    CalendarSelectors,\r\n    CalendarEvents,\r\n    Templates,\r\n    CalendarViewManager\r\n) {\r\n\r\n    /**\r\n     * Listen to and handle any calendar events fired by the calendar UI.\r\n     *\r\n     * @method registerCalendarEventListeners\r\n     * @param {object} root The calendar root element\r\n     */\r\n    var registerCalendarEventListeners = function(root) {\r\n        var body = $('body');\r\n        body.on([CalendarEvents.monthChanged, CalendarEvents.dayChanged].join(' '), function(e, year, month, courseId, categoryId) {\r\n            // We have to use a queue here because the calling code is decoupled from these listeners.\r\n            // It's possible for the event to be called multiple times before one call is fully resolved.\r\n            root.queue(function(next) {\r\n                return processRequest(e, year, month, courseId, categoryId)\r\n                .then(function() {\r\n                    return next();\r\n                })\r\n                .fail(Notification.exception)\r\n                ;\r\n            });\r\n        });\r\n\r\n        var processRequest = function(e, year, month, courseId, categoryId) {\r\n            var newCurrentMonth = root.find('[data-year=\"' + year + '\"][data-month=\"' + month + '\"]');\r\n            var newParent = newCurrentMonth.closest(CalendarSelectors.calendarPeriods.month);\r\n            var allMonths = root.find(CalendarSelectors.calendarPeriods.month);\r\n\r\n            var previousMonth = $(allMonths[0]);\r\n            var nextMonth = $(allMonths[2]);\r\n\r\n            var placeHolder = $('<span>');\r\n            placeHolder.attr('data-template', 'core_calendar/threemonth_month');\r\n            placeHolder.attr('data-includenavigation', false);\r\n            placeHolder.attr('data-mini', true);\r\n            var placeHolderContainer = $('<div>');\r\n            placeHolderContainer.hide();\r\n            placeHolderContainer.append(placeHolder);\r\n\r\n            var requestYear;\r\n            var requestMonth;\r\n            var oldMonth;\r\n\r\n            if (newParent.is(previousMonth)) {\r\n                // Fetch the new previous month.\r\n                placeHolderContainer.insertBefore(previousMonth);\r\n\r\n                requestYear = previousMonth.data('previousYear');\r\n                requestMonth = previousMonth.data('previousMonth');\r\n                oldMonth = nextMonth;\r\n            } else if (newParent.is(nextMonth)) {\r\n                // Fetch the new next month.\r\n                placeHolderContainer.insertAfter(nextMonth);\r\n                requestYear = nextMonth.data('nextYear');\r\n                requestMonth = nextMonth.data('nextMonth');\r\n                oldMonth = previousMonth;\r\n            } else {\r\n                return $.Deferred().resolve();\r\n            }\r\n\r\n            return CalendarViewManager.refreshMonthContent(\r\n                placeHolder,\r\n                requestYear,\r\n                requestMonth,\r\n                courseId,\r\n                categoryId,\r\n                placeHolder\r\n            )\r\n            .then(function() {\r\n                var slideUpPromise = $.Deferred();\r\n                var slideDownPromise = $.Deferred();\r\n                oldMonth.slideUp('fast', function() {\r\n                    $(this).remove();\r\n                    slideUpPromise.resolve();\r\n                });\r\n                placeHolderContainer.slideDown('fast', function() {\r\n                    slideDownPromise.resolve();\r\n                });\r\n\r\n                return $.when(slideUpPromise, slideDownPromise);\r\n            });\r\n        };\r\n\r\n        // Listen for a click on the day link in the three month block to load the day view.\r\n        root.on('click', CalendarSelectors.links.miniDayLink, function(e) {\r\n\r\n                var miniDayLink = $(e.target);\r\n                var year = miniDayLink.data('year'),\r\n                    month = miniDayLink.data('month'),\r\n                    day = miniDayLink.text(),\r\n                    courseId = miniDayLink.data('courseid'),\r\n                    categoryId = miniDayLink.data('categoryid'),\r\n                    calendarRoot = $('body').find(CalendarSelectors.calendarMain);\r\n                CalendarViewManager.refreshDayContent(calendarRoot, year, month, day, courseId, categoryId,\r\n                    calendarRoot.find('[id^=\"calendar-\"][data-template^=\"core_calendar/\"]'), 'core_calendar/calendar_day');\r\n                e.preventDefault();\r\n                CalendarViewManager.updateUrl('?view=day');\r\n        });\r\n    };\r\n\r\n    return {\r\n        init: function(root) {\r\n            root = $(root);\r\n\r\n            registerCalendarEventListeners(root);\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","Notification","CalendarSelectors","CalendarEvents","Templates","CalendarViewManager","init","root","on","monthChanged","dayChanged","join","e","year","month","courseId","categoryId","queue","next","processRequest","then","fail","exception","newParent","find","closest","calendarPeriods","allMonths","previousMonth","nextMonth","placeHolder","attr","requestYear","requestMonth","oldMonth","placeHolderContainer","hide","append","is","insertBefore","data","Deferred","resolve","insertAfter","refreshMonthContent","slideUpPromise","slideDownPromise","slideUp","this","remove","slideDown","when","links","miniDayLink","target","day","text","calendarRoot","calendarMain","refreshDayContent","preventDefault","updateUrl","registerCalendarEventListeners"],"mappings":";;;;;;;;;;AAyBAA,2CAAO,CACH,SACA,oBACA,0BACA,uBACA,iBACA,+BAEJ,SACIC,EACAC,aACAC,kBACAC,eACAC,UACAC,2BAqGO,CACHC,KAAM,SAASC,OA7FkB,SAASA,MAC/BP,EAAE,QACRQ,GAAG,CAACL,eAAeM,aAAcN,eAAeO,YAAYC,KAAK,MAAM,SAASC,EAAGC,KAAMC,MAAOC,SAAUC,YAG3GT,KAAKU,OAAM,SAASC,aACTC,eAAeP,EAAGC,KAAMC,MAAOC,SAAUC,YAC/CI,MAAK,kBACKF,UAEVG,KAAKpB,aAAaqB,qBAKvBH,eAAiB,SAASP,EAAGC,KAAMC,MAAOC,SAAUC,gBAEhDO,UADkBhB,KAAKiB,KAAK,eAAiBX,KAAO,kBAAoBC,MAAQ,MACpDW,QAAQvB,kBAAkBwB,gBAAgBZ,OACtEa,UAAYpB,KAAKiB,KAAKtB,kBAAkBwB,gBAAgBZ,OAExDc,cAAgB5B,EAAE2B,UAAU,IAC5BE,UAAY7B,EAAE2B,UAAU,IAExBG,YAAc9B,EAAE,UACpB8B,YAAYC,KAAK,gBAAiB,kCAClCD,YAAYC,KAAK,0BAA0B,GAC3CD,YAAYC,KAAK,aAAa,OAK1BC,YACAC,aACAC,SANAC,qBAAuBnC,EAAE,YAC7BmC,qBAAqBC,OACrBD,qBAAqBE,OAAOP,aAMxBP,UAAUe,GAAGV,eAEbO,qBAAqBI,aAAaX,eAElCI,YAAcJ,cAAcY,KAAK,gBACjCP,aAAeL,cAAcY,KAAK,iBAClCN,SAAWL,cACR,CAAA,IAAIN,UAAUe,GAAGT,kBAOb7B,EAAEyC,WAAWC,UALpBP,qBAAqBQ,YAAYd,WACjCG,YAAcH,UAAUW,KAAK,YAC7BP,aAAeJ,UAAUW,KAAK,aAC9BN,SAAWN,qBAKRvB,oBAAoBuC,oBACvBd,YACAE,YACAC,aACAlB,SACAC,WACAc,aAEHV,MAAK,eACEyB,eAAiB7C,EAAEyC,WACnBK,iBAAmB9C,EAAEyC,kBACzBP,SAASa,QAAQ,QAAQ,WACrB/C,EAAEgD,MAAMC,SACRJ,eAAeH,aAEnBP,qBAAqBe,UAAU,QAAQ,WACnCJ,iBAAiBJ,aAGd1C,EAAEmD,KAAKN,eAAgBC,sBAKtCvC,KAAKC,GAAG,QAASN,kBAAkBkD,MAAMC,aAAa,SAASzC,OAEnDyC,YAAcrD,EAAEY,EAAE0C,QAClBzC,KAAOwC,YAAYb,KAAK,QACxB1B,MAAQuC,YAAYb,KAAK,SACzBe,IAAMF,YAAYG,OAClBzC,SAAWsC,YAAYb,KAAK,YAC5BxB,WAAaqC,YAAYb,KAAK,cAC9BiB,aAAezD,EAAE,QAAQwB,KAAKtB,kBAAkBwD,cACpDrD,oBAAoBsD,kBAAkBF,aAAc5C,KAAMC,MAAOyC,IAAKxC,SAAUC,WAC5EyC,aAAajC,KAAK,sDAAuD,8BAC7EZ,EAAEgD,iBACFvD,oBAAoBwD,UAAU,gBAQlCC,CAFAvD,KAAOP,EAAEO"}