{"version":3,"file":"grade_user_competency_inline.min.js","sources":["../src/grade_user_competency_inline.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module to enable inline editing of a comptency grade.\r\n *\r\n * @module     tool_lp/grade_user_competency_inline\r\n * @copyright  2015 Damyon Wiese\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery',\r\n        'core/notification',\r\n        'core/ajax',\r\n        'core/log',\r\n        'tool_lp/grade_dialogue',\r\n        'tool_lp/event_base',\r\n        'tool_lp/scalevalues',\r\n    ], function($, notification, ajax, log, GradeDialogue, EventBase, ScaleValues) {\r\n\r\n    /**\r\n     * InlineEditor\r\n     *\r\n     * @class tool_lp/grade_user_competency_inline\r\n     * @param {String} selector The selector to trigger the grading.\r\n     * @param {Number} scaleId The id of the scale for this competency.\r\n     * @param {Number} competencyId The id of the competency.\r\n     * @param {Number} userId The id of the user.\r\n     * @param {Number} planId The id of the plan.\r\n     * @param {Number} courseId The id of the course.\r\n     * @param {String} chooseStr Language string for choose a rating.\r\n     */\r\n    var InlineEditor = function(selector, scaleId, competencyId, userId, planId, courseId, chooseStr) {\r\n        EventBase.prototype.constructor.apply(this, []);\r\n\r\n        var trigger = $(selector);\r\n        if (!trigger.length) {\r\n            throw new Error('Could not find the trigger');\r\n        }\r\n\r\n        this._scaleId = scaleId;\r\n        this._competencyId = competencyId;\r\n        this._userId = userId;\r\n        this._planId = planId;\r\n        this._courseId = courseId;\r\n        this._chooseStr = chooseStr;\r\n        this._setUp();\r\n\r\n        trigger.click(function(e) {\r\n            e.preventDefault();\r\n            this._dialogue.display();\r\n        }.bind(this));\r\n\r\n        if (this._planId) {\r\n            this._methodName = 'core_competency_grade_competency_in_plan';\r\n            this._args = {\r\n                competencyid: this._competencyId,\r\n                planid: this._planId\r\n            };\r\n        } else if (this._courseId) {\r\n            this._methodName = 'core_competency_grade_competency_in_course';\r\n            this._args = {\r\n                competencyid: this._competencyId,\r\n                courseid: this._courseId,\r\n                userid: this._userId\r\n            };\r\n        } else {\r\n            this._methodName = 'core_competency_grade_competency';\r\n            this._args = {\r\n                userid: this._userId,\r\n                competencyid: this._competencyId\r\n            };\r\n        }\r\n    };\r\n    InlineEditor.prototype = Object.create(EventBase.prototype);\r\n\r\n    /**\r\n     * Setup.\r\n     *\r\n     * @method _setUp\r\n     */\r\n    InlineEditor.prototype._setUp = function() {\r\n        var options = [],\r\n            self = this;\r\n\r\n        M.util.js_pending('tool_lp/grade_user_competency_inline:_setUp');\r\n        var promise = ScaleValues.get_values(self._scaleId);\r\n        promise.then(function(scalevalues) {\r\n            options.push({\r\n                value: '',\r\n                name: self._chooseStr\r\n            });\r\n\r\n            for (var i = 0; i < scalevalues.length; i++) {\r\n                var optionConfig = scalevalues[i];\r\n                options.push({\r\n                    value: optionConfig.id,\r\n                    name: optionConfig.name\r\n                });\r\n            }\r\n\r\n            return options;\r\n        })\r\n        .then(function(options) {\r\n            return new GradeDialogue(options);\r\n        })\r\n        .then(function(dialogue) {\r\n            dialogue.on('rated', function(e, data) {\r\n                var args = self._args;\r\n                args.grade = data.rating;\r\n                args.note = data.note;\r\n                ajax.call([{\r\n                    methodname: self._methodName,\r\n                    args: args,\r\n                    done: function(evidence) {\r\n                        self._trigger('competencyupdated', {args: args, evidence: evidence});\r\n                    },\r\n                    fail: notification.exception\r\n                }]);\r\n            });\r\n\r\n            return dialogue;\r\n        })\r\n        .then(function(dialogue) {\r\n            self._dialogue = dialogue;\r\n\r\n            M.util.js_complete('tool_lp/grade_user_competency_inline:_setUp');\r\n            return;\r\n        })\r\n        .fail(notification.exception);\r\n    };\r\n\r\n    /** @property {Number} The scale id for this competency. */\r\n    InlineEditor.prototype._scaleId = null;\r\n    /** @property {Number} The id of the competency. */\r\n    InlineEditor.prototype._competencyId = null;\r\n    /** @property {Number} The id of the user. */\r\n    InlineEditor.prototype._userId = null;\r\n    /** @property {Number} The id of the plan. */\r\n    InlineEditor.prototype._planId = null;\r\n    /** @property {Number} The id of the course. */\r\n    InlineEditor.prototype._courseId = null;\r\n    /** @property {String} The text for Choose rating. */\r\n    InlineEditor.prototype._chooseStr = null;\r\n    /** @property {GradeDialogue} The grading dialogue. */\r\n    InlineEditor.prototype._dialogue = null;\r\n\r\n    return InlineEditor;\r\n});\r\n"],"names":["define","$","notification","ajax","log","GradeDialogue","EventBase","ScaleValues","InlineEditor","selector","scaleId","competencyId","userId","planId","courseId","chooseStr","prototype","constructor","apply","this","trigger","length","Error","_scaleId","_competencyId","_userId","_planId","_courseId","_chooseStr","_setUp","click","e","preventDefault","_dialogue","display","bind","_methodName","_args","competencyid","planid","courseid","userid","Object","create","options","self","M","util","js_pending","get_values","then","scalevalues","push","value","name","i","optionConfig","id","dialogue","on","data","args","grade","rating","note","call","methodname","done","evidence","_trigger","fail","exception","js_complete"],"mappings":";;;;;;;AAuBAA,8CAAO,CAAC,SACA,oBACA,YACA,WACA,yBACA,qBACA,wBACD,SAASC,EAAGC,aAAcC,KAAMC,IAAKC,cAAeC,UAAWC,iBAc9DC,aAAe,SAASC,SAAUC,QAASC,aAAcC,OAAQC,OAAQC,SAAUC,WACnFT,UAAUU,UAAUC,YAAYC,MAAMC,KAAM,QAExCC,QAAUnB,EAAEQ,cACXW,QAAQC,aACH,IAAIC,MAAM,mCAGfC,SAAWb,aACXc,cAAgBb,kBAChBc,QAAUb,YACVc,QAAUb,YACVc,UAAYb,cACZc,WAAab,eACbc,SAELT,QAAQU,MAAM,SAASC,GACnBA,EAAEC,sBACGC,UAAUC,WACjBC,KAAKhB,OAEHA,KAAKO,cACAU,YAAc,gDACdC,MAAQ,CACTC,aAAcnB,KAAKK,cACnBe,OAAQpB,KAAKO,UAEVP,KAAKQ,gBACPS,YAAc,kDACdC,MAAQ,CACTC,aAAcnB,KAAKK,cACnBgB,SAAUrB,KAAKQ,UACfc,OAAQtB,KAAKM,gBAGZW,YAAc,wCACdC,MAAQ,CACTI,OAAQtB,KAAKM,QACba,aAAcnB,KAAKK,wBAI/BhB,aAAaQ,UAAY0B,OAAOC,OAAOrC,UAAUU,YAO1Ba,OAAS,eACxBe,QAAU,GACVC,KAAO1B,KAEX2B,EAAEC,KAAKC,WAAW,+CACJzC,YAAY0C,WAAWJ,KAAKtB,UAClC2B,MAAK,SAASC,aAClBP,QAAQQ,KAAK,CACTC,MAAO,GACPC,KAAMT,KAAKjB,iBAGV,IAAI2B,EAAI,EAAGA,EAAIJ,YAAY9B,OAAQkC,IAAK,KACrCC,aAAeL,YAAYI,GAC/BX,QAAQQ,KAAK,CACTC,MAAOG,aAAaC,GACpBH,KAAME,aAAaF,cAIpBV,WAEVM,MAAK,SAASN,gBACJ,IAAIvC,cAAcuC,YAE5BM,MAAK,SAASQ,iBACXA,SAASC,GAAG,SAAS,SAAS5B,EAAG6B,UACzBC,KAAOhB,KAAKR,MAChBwB,KAAKC,MAAQF,KAAKG,OAClBF,KAAKG,KAAOJ,KAAKI,KACjB7D,KAAK8D,KAAK,CAAC,CACPC,WAAYrB,KAAKT,YACjByB,KAAMA,KACNM,KAAM,SAASC,UACXvB,KAAKwB,SAAS,oBAAqB,CAACR,KAAMA,KAAMO,SAAUA,YAE9DE,KAAMpE,aAAaqE,gBAIpBb,YAEVR,MAAK,SAASQ,UACXb,KAAKZ,UAAYyB,SAEjBZ,EAAEC,KAAKyB,YAAY,kDAGtBF,KAAKpE,aAAaqE,YAIvB/D,aAAaQ,UAAUO,SAAW,KAElCf,aAAaQ,UAAUQ,cAAgB,KAEvChB,aAAaQ,UAAUS,QAAU,KAEjCjB,aAAaQ,UAAUU,QAAU,KAEjClB,aAAaQ,UAAUW,UAAY,KAEnCnB,aAAaQ,UAAUY,WAAa,KAEpCpB,aAAaQ,UAAUiB,UAAY,KAE5BzB"}