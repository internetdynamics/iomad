{"version":3,"file":"search.min.js","sources":["../src/search.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This module adds ajax search functions to the template library page.\r\n *\r\n * @module     tool_templatelibrary/search\r\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery', 'core/ajax', 'core/log', 'core/notification', 'core/templates', 'core/config'],\r\n       function($, ajax, log, notification, templates, config) {\r\n\r\n    /**\r\n     * The ajax call has returned with a new list of templates.\r\n     *\r\n     * @method reloadListTemplate\r\n     * @param {String[]} templateList List of template ids.\r\n     */\r\n    var reloadListTemplate = function(templateList) {\r\n        templates.render('tool_templatelibrary/search_results', {templates: templateList})\r\n            .done(function(result, js) {\r\n                templates.replaceNode($('[data-region=\"searchresults\"]'), result, js);\r\n            }).fail(notification.exception);\r\n    };\r\n\r\n    /**\r\n     * Get the current values for the form inputs and refresh the list of matching templates.\r\n     *\r\n     * @method refreshSearch\r\n     * @param {String} themename The naeme of the theme.\r\n     */\r\n    var refreshSearch = function(themename) {\r\n        var componentStr = $('[data-field=\"component\"]').val();\r\n        var searchStr = $('[data-region=\"list-templates\"] [data-region=\"input\"]').val();\r\n\r\n        if (searchStr !== '') {\r\n            $('[data-region=\"list-templates\"] [data-action=\"clearsearch\"]').removeClass('d-none');\r\n        } else {\r\n            $('[data-region=\"list-templates\"] [data-action=\"clearsearch\"]').addClass('d-none');\r\n        }\r\n\r\n        // Trigger the search.\r\n        ajax.call([\r\n            {methodname: 'tool_templatelibrary_list_templates',\r\n              args: {component: componentStr, search: searchStr, themename: themename},\r\n              done: reloadListTemplate,\r\n              fail: notification.exception}\r\n        ], true, false);\r\n    };\r\n\r\n    var throttle = null;\r\n\r\n    /**\r\n     * Call the specified function after a delay. If this function is called again before the function is executed,\r\n     * the function will only be executed once.\r\n     *\r\n     * @method queueRefresh\r\n     * @param {function} callback\r\n     * @param {Number} delay The time in milliseconds to delay.\r\n     */\r\n    var queueRefresh = function(callback, delay) {\r\n        if (throttle !== null) {\r\n            window.clearTimeout(throttle);\r\n        }\r\n\r\n        throttle = window.setTimeout(function() {\r\n            callback();\r\n            throttle = null;\r\n        }, delay);\r\n    };\r\n\r\n    var changeHandler = function() {\r\n        queueRefresh(refreshSearch.bind(this, config.theme), 400);\r\n    };\r\n    // Add change handlers to refresh the list.\r\n    $('[data-region=\"list-templates\"]').on('change', '[data-field=\"component\"]', changeHandler);\r\n    $('[data-region=\"list-templates\"]').on('input', '[data-region=\"input\"]', changeHandler);\r\n    $('[data-action=\"clearsearch\"]').on('click', function() {\r\n        $('[data-region=\"input\"]').val('');\r\n        refreshSearch(config.theme);\r\n        $(this).addClass('d-none');\r\n    });\r\n\r\n    refreshSearch(config.theme);\r\n    return {};\r\n});\r\n"],"names":["define","$","ajax","log","notification","templates","config","reloadListTemplate","templateList","render","done","result","js","replaceNode","fail","exception","refreshSearch","themename","componentStr","val","searchStr","removeClass","addClass","call","methodname","args","component","search","throttle","changeHandler","callback","delay","bind","this","theme","window","clearTimeout","setTimeout","on"],"mappings":";;;;;;;AAsBAA,qCAAO,CAAC,SAAU,YAAa,WAAY,oBAAqB,iBAAkB,gBAC3E,SAASC,EAAGC,KAAMC,IAAKC,aAAcC,UAAWC,YAQ/CC,mBAAqB,SAASC,cAC9BH,UAAUI,OAAO,sCAAuC,CAACJ,UAAWG,eAC/DE,MAAK,SAASC,OAAQC,IACnBP,UAAUQ,YAAYZ,EAAE,iCAAkCU,OAAQC,OACnEE,KAAKV,aAAaW,YASzBC,cAAgB,SAASC,eACrBC,aAAejB,EAAE,4BAA4BkB,MAC7CC,UAAYnB,EAAE,wDAAwDkB,MAExD,KAAdC,UACAnB,EAAE,8DAA8DoB,YAAY,UAE5EpB,EAAE,8DAA8DqB,SAAS,UAI7EpB,KAAKqB,KAAK,CACN,CAACC,WAAY,sCACXC,KAAM,CAACC,UAAWR,aAAcS,OAAQP,UAAWH,UAAWA,WAC9DP,KAAMH,mBACNO,KAAMV,aAAaW,aACtB,GAAM,IAGTa,SAAW,KAqBXC,cAAgB,WAXD,IAASC,SAAUC,MAAVD,SAYXd,cAAcgB,KAAKC,KAAM3B,OAAO4B,OAZXH,MAYmB,IAXpC,OAAbH,UACAO,OAAOC,aAAaR,UAGxBA,SAAWO,OAAOE,YAAW,WACzBP,WACAF,SAAW,OACZG,eAOP9B,EAAE,kCAAkCqC,GAAG,SAAU,2BAA4BT,eAC7E5B,EAAE,kCAAkCqC,GAAG,QAAS,wBAAyBT,eACzE5B,EAAE,+BAA+BqC,GAAG,SAAS,WACzCrC,EAAE,yBAAyBkB,IAAI,IAC/BH,cAAcV,OAAO4B,OACrBjC,EAAEgC,MAAMX,SAAS,aAGrBN,cAAcV,OAAO4B,OACd"}