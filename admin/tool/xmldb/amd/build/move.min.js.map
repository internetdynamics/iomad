{"version":3,"file":"move.min.js","sources":["../src/move.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\ndefine(['jquery', 'core/sortable_list', 'core/ajax', 'core/notification'], function($, SortableList, Ajax, Notification) {\r\n    return {\r\n        init: function(tableid, moveaction) {\r\n            // Initialise sortable for the given list.\r\n            var sort = new SortableList('#' + tableid + ' tbody');\r\n            sort.getElementName = function(element) {\r\n                return $.Deferred().resolve(element.attr('data-name'));\r\n            };\r\n            var origIndex;\r\n            $('#' + tableid + ' tbody tr').on(SortableList.EVENTS.DRAGSTART, function(_, info) {\r\n                // Remember position of the element in the beginning of dragging.\r\n                origIndex = info.sourceList.children().index(info.element);\r\n                // Resize the \"proxy\" element to be the same width as the main element.\r\n                setTimeout(function() {\r\n                    $('.sortable-list-is-dragged').width(info.element.width());\r\n                }, 501);\r\n            }).on(SortableList.EVENTS.DROP, function(_, info) {\r\n                // When a list element was moved send AJAX request to the server.\r\n                var newIndex = info.targetList.children().index(info.element);\r\n                var t = info.element.find('[data-action=' + moveaction + ']');\r\n                if (info.positionChanged && t.length) {\r\n                    var request = {\r\n                        methodname: 'tool_xmldb_invoke_move_action',\r\n                        args: {\r\n                            action: moveaction,\r\n                            dir: t.attr('data-dir'),\r\n                            table: t.attr('data-table'),\r\n                            field: t.attr('data-field'),\r\n                            key: t.attr('data-key'),\r\n                            index: t.attr('data-index'),\r\n                            position: newIndex - origIndex\r\n                        }\r\n                    };\r\n                    Ajax.call([request])[0].fail(Notification.exception);\r\n                }\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","SortableList","Ajax","Notification","init","tableid","moveaction","origIndex","getElementName","element","Deferred","resolve","attr","on","EVENTS","DRAGSTART","_","info","sourceList","children","index","setTimeout","width","DROP","newIndex","targetList","t","find","positionChanged","length","request","methodname","args","action","dir","table","field","key","position","call","fail","exception"],"mappings":"AAeAA,yBAAO,CAAC,SAAU,qBAAsB,YAAa,sBAAsB,SAASC,EAAGC,aAAcC,KAAMC,oBAChG,CACHC,KAAM,SAASC,QAASC,gBAMhBC,UAJO,IAAIN,aAAa,IAAMI,QAAU,UACvCG,eAAiB,SAASC,gBACpBT,EAAEU,WAAWC,QAAQF,QAAQG,KAAK,eAG7CZ,EAAE,IAAMK,QAAU,aAAaQ,GAAGZ,aAAaa,OAAOC,WAAW,SAASC,EAAGC,MAEzEV,UAAYU,KAAKC,WAAWC,WAAWC,MAAMH,KAAKR,SAElDY,YAAW,WACPrB,EAAE,6BAA6BsB,MAAML,KAAKR,QAAQa,WACnD,QACJT,GAAGZ,aAAaa,OAAOS,MAAM,SAASP,EAAGC,UAEpCO,SAAWP,KAAKQ,WAAWN,WAAWC,MAAMH,KAAKR,SACjDiB,EAAIT,KAAKR,QAAQkB,KAAK,gBAAkBrB,WAAa,QACrDW,KAAKW,iBAAmBF,EAAEG,OAAQ,KAC9BC,QAAU,CACVC,WAAY,gCACZC,KAAM,CACFC,OAAQ3B,WACR4B,IAAKR,EAAEd,KAAK,YACZuB,MAAOT,EAAEd,KAAK,cACdwB,MAAOV,EAAEd,KAAK,cACdyB,IAAKX,EAAEd,KAAK,YACZQ,MAAOM,EAAEd,KAAK,cACd0B,SAAUd,SAAWjB,YAG7BL,KAAKqC,KAAK,CAACT,UAAU,GAAGU,KAAKrC,aAAasC"}