{"version":3,"file":"managedocsactions.min.js","sources":["../src/managedocsactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Adds support for confirmation via JS modal for some management actions at the Manage policies page.\r\n *\r\n * @module      tool_policy/managedocsactions\r\n * @copyright   2018 David Mudr√°k <david@moodle.com>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/log',\r\n    'core/config',\r\n    'core/str',\r\n    'core/modal_factory',\r\n    'core/modal_events'\r\n], function($, Log, Config, Str, ModalFactory, ModalEvents) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * List of action selectors.\r\n     *\r\n     * @property {string} LINKS - Selector for all action links\r\n     * @property {string} MAKE_CURRENT\r\n     */\r\n    var ACTION = {\r\n        LINKS: '[data-action]',\r\n        MAKE_CURRENT: '[data-action=\"makecurrent\"]',\r\n        INACTIVATE: '[data-action=\"inactivate\"]',\r\n        DELETE: '[data-action=\"delete\"]'\r\n    };\r\n\r\n    /**\r\n     * @constructor\r\n     * @param {Element} base - Management area wrapping element\r\n     */\r\n    function ManageDocsActions(base) {\r\n        this.base = base;\r\n\r\n        this.initEvents();\r\n    }\r\n\r\n    /**\r\n     * Register event listeners.\r\n     */\r\n    ManageDocsActions.prototype.initEvents = function() {\r\n        var self = this;\r\n\r\n        self.base.on('click', ACTION.LINKS, function(e) {\r\n            e.stopPropagation();\r\n\r\n            var link = $(e.currentTarget);\r\n            var promise;\r\n            var strings;\r\n\r\n            if (link.is(ACTION.MAKE_CURRENT)) {\r\n                promise = Str.get_strings([\r\n                    {key: 'activating', component: 'tool_policy'},\r\n                    {key: 'activateconfirm', component: 'tool_policy', param: {\r\n                        name: link.closest('[data-policy-name]').attr('data-policy-name'),\r\n                        revision: link.closest('[data-policy-revision]').attr('data-policy-revision')\r\n                    }},\r\n                    {key: 'activateconfirmyes', component: 'tool_policy'}\r\n                ]);\r\n\r\n            } else if (link.is(ACTION.INACTIVATE)) {\r\n                promise = Str.get_strings([\r\n                    {key: 'inactivating', component: 'tool_policy'},\r\n                    {key: 'inactivatingconfirm', component: 'tool_policy', param: {\r\n                        name: link.closest('[data-policy-name]').attr('data-policy-name'),\r\n                        revision: link.closest('[data-policy-revision]').attr('data-policy-revision')\r\n                    }},\r\n                    {key: 'inactivatingconfirmyes', component: 'tool_policy'}\r\n                ]);\r\n\r\n            } else if (link.is(ACTION.DELETE)) {\r\n                promise = Str.get_strings([\r\n                    {key: 'deleting', component: 'tool_policy'},\r\n                    {key: 'deleteconfirm', component: 'tool_policy', param: {\r\n                        name: link.closest('[data-policy-name]').attr('data-policy-name'),\r\n                        revision: link.closest('[data-policy-revision]').attr('data-policy-revision')\r\n                    }},\r\n                    {key: 'delete', component: 'core'}\r\n                ]);\r\n\r\n            } else {\r\n                Log.error('unknown action type detected', 'tool_policy/managedocsactions');\r\n                return;\r\n            }\r\n\r\n            e.preventDefault();\r\n\r\n            promise.then(function(strs) {\r\n                strings = strs;\r\n                return ModalFactory.create({\r\n                    title: strings[0],\r\n                    body: strings[1],\r\n                    type: ModalFactory.types.SAVE_CANCEL\r\n                });\r\n\r\n            }).then(function(modal) {\r\n                modal.setSaveButtonText(strings[2]);\r\n                modal.getRoot().on(ModalEvents.save, function() {\r\n                    window.location.href = link.attr('href') + '&sesskey=' + Config.sesskey + '&confirm=1';\r\n                });\r\n\r\n                modal.getRoot().on(ModalEvents.hidden, function() {\r\n                    modal.destroy();\r\n                });\r\n\r\n                modal.show();\r\n                return true;\r\n\r\n            }).catch(function(e) {\r\n                Log.error(e);\r\n                return false;\r\n            });\r\n        });\r\n    };\r\n\r\n    return {\r\n        /**\r\n         * Factory method returning instance of the ManageDocsActions\r\n         *\r\n         * @param {String} baseid - ID of the management area wrapping element\r\n         * @return {ManageDocsActions}\r\n         */\r\n        init: function(baseid) {\r\n            var base = $(document.getElementById(baseid));\r\n\r\n            if (base.length) {\r\n                return new ManageDocsActions(base);\r\n\r\n            } else {\r\n                throw new Error(\"managedocsactions: Invalid base element identifier\");\r\n            }\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","Log","Config","Str","ModalFactory","ModalEvents","ACTION","ManageDocsActions","base","initEvents","prototype","this","on","e","stopPropagation","promise","strings","link","currentTarget","is","get_strings","key","component","param","name","closest","attr","revision","error","preventDefault","then","strs","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","save","window","location","href","sesskey","hidden","destroy","show","catch","init","baseid","document","getElementById","length","Error"],"mappings":";;;;;;;AAsBAA,uCAAO,CACH,SACA,WACA,cACA,WACA,qBACA,sBACD,SAASC,EAAGC,IAAKC,OAAQC,IAAKC,aAAcC,iBAUvCC,aACO,gBADPA,oBAEc,8BAFdA,kBAGY,6BAHZA,cAIQ,kCAOHC,kBAAkBC,WAClBA,KAAOA,UAEPC,oBAMTF,kBAAkBG,UAAUD,WAAa,WAC1BE,KAENH,KAAKI,GAAG,QAASN,cAAc,SAASO,GACzCA,EAAEC,sBAGEC,QACAC,QAFAC,KAAOjB,EAAEa,EAAEK,kBAIXD,KAAKE,GAAGb,qBACRS,QAAUZ,IAAIiB,YAAY,CACtB,CAACC,IAAK,aAAcC,UAAW,eAC/B,CAACD,IAAK,kBAAmBC,UAAW,cAAeC,MAAO,CACtDC,KAAMP,KAAKQ,QAAQ,sBAAsBC,KAAK,oBAC9CC,SAAUV,KAAKQ,QAAQ,0BAA0BC,KAAK,0BAE1D,CAACL,IAAK,qBAAsBC,UAAW,sBAGxC,GAAIL,KAAKE,GAAGb,mBACfS,QAAUZ,IAAIiB,YAAY,CACtB,CAACC,IAAK,eAAgBC,UAAW,eACjC,CAACD,IAAK,sBAAuBC,UAAW,cAAeC,MAAO,CAC1DC,KAAMP,KAAKQ,QAAQ,sBAAsBC,KAAK,oBAC9CC,SAAUV,KAAKQ,QAAQ,0BAA0BC,KAAK,0BAE1D,CAACL,IAAK,yBAA0BC,UAAW,qBAG5C,CAAA,IAAIL,KAAKE,GAAGb,2BAWfL,IAAI2B,MAAM,+BAAgC,iCAV1Cb,QAAUZ,IAAIiB,YAAY,CACtB,CAACC,IAAK,WAAYC,UAAW,eAC7B,CAACD,IAAK,gBAAiBC,UAAW,cAAeC,MAAO,CACpDC,KAAMP,KAAKQ,QAAQ,sBAAsBC,KAAK,oBAC9CC,SAAUV,KAAKQ,QAAQ,0BAA0BC,KAAK,0BAE1D,CAACL,IAAK,SAAUC,UAAW,UAQnCT,EAAEgB,iBAEFd,QAAQe,MAAK,SAASC,aAClBf,QAAUe,KACH3B,aAAa4B,OAAO,CACvBC,MAAOjB,QAAQ,GACfkB,KAAMlB,QAAQ,GACdmB,KAAM/B,aAAagC,MAAMC,iBAG9BP,MAAK,SAASQ,cACbA,MAAMC,kBAAkBvB,QAAQ,IAChCsB,MAAME,UAAU5B,GAAGP,YAAYoC,MAAM,WACjCC,OAAOC,SAASC,KAAO3B,KAAKS,KAAK,QAAU,YAAcxB,OAAO2C,QAAU,gBAG9EP,MAAME,UAAU5B,GAAGP,YAAYyC,QAAQ,WACnCR,MAAMS,aAGVT,MAAMU,QACC,KAERC,OAAM,SAASpC,UACdZ,IAAI2B,MAAMf,IACH,SAKZ,CAOHqC,KAAM,SAASC,YACP3C,KAAOR,EAAEoD,SAASC,eAAeF,YAEjC3C,KAAK8C,cACE,IAAI/C,kBAAkBC,YAGvB,IAAI+C,MAAM"}