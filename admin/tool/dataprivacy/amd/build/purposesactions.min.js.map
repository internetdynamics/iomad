{"version":3,"file":"purposesactions.min.js","sources":["../src/purposesactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * AMD module for purposes actions.\r\n *\r\n * @module     tool_dataprivacy/purposesactions\r\n * @copyright  2018 David Monllao\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/ajax',\r\n    'core/notification',\r\n    'core/str',\r\n    'core/modal_factory',\r\n    'core/modal_events'],\r\nfunction($, Ajax, Notification, Str, ModalFactory, ModalEvents) {\r\n\r\n    /**\r\n     * List of action selectors.\r\n     *\r\n     * @type {{DELETE: string}}\r\n     */\r\n    var ACTIONS = {\r\n        DELETE: '[data-action=\"deletepurpose\"]',\r\n    };\r\n\r\n    /**\r\n     * PurposesActions class.\r\n     */\r\n    var PurposesActions = function() {\r\n        this.registerEvents();\r\n    };\r\n\r\n    /**\r\n     * Register event listeners.\r\n     */\r\n    PurposesActions.prototype.registerEvents = function() {\r\n        $(ACTIONS.DELETE).click(function(e) {\r\n            e.preventDefault();\r\n\r\n            var id = $(this).data('id');\r\n            var purposename = $(this).data('name');\r\n            var stringkeys = [\r\n                {\r\n                    key: 'deletepurpose',\r\n                    component: 'tool_dataprivacy'\r\n                },\r\n                {\r\n                    key: 'deletepurposetext',\r\n                    component: 'tool_dataprivacy',\r\n                    param: purposename\r\n                },\r\n                {\r\n                    key: 'delete'\r\n                }\r\n            ];\r\n\r\n            Str.get_strings(stringkeys).then(function(langStrings) {\r\n                var title = langStrings[0];\r\n                var confirmMessage = langStrings[1];\r\n                var buttonText = langStrings[2];\r\n                return ModalFactory.create({\r\n                    title: title,\r\n                    body: confirmMessage,\r\n                    type: ModalFactory.types.SAVE_CANCEL\r\n                }).then(function(modal) {\r\n                    modal.setSaveButtonText(buttonText);\r\n\r\n                    // Handle save event.\r\n                    modal.getRoot().on(ModalEvents.save, function() {\r\n\r\n                        var request = {\r\n                            methodname: 'tool_dataprivacy_delete_purpose',\r\n                            args: {'id': id}\r\n                        };\r\n\r\n                        Ajax.call([request])[0].done(function(data) {\r\n                            if (data.result) {\r\n                                $('tr[data-purposeid=\"' + id + '\"]').remove();\r\n                            } else {\r\n                                Notification.addNotification({\r\n                                    message: data.warnings[0].message,\r\n                                    type: 'error'\r\n                                });\r\n                            }\r\n                        }).fail(Notification.exception);\r\n                    });\r\n\r\n                    // Handle hidden event.\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        // Destroy when hidden.\r\n                        modal.destroy();\r\n                    });\r\n\r\n                    return modal;\r\n                });\r\n            }).done(function(modal) {\r\n                modal.show();\r\n\r\n            }).fail(Notification.exception);\r\n        });\r\n    };\r\n\r\n    return /** @alias module:tool_dataprivacy/purposesactions */ {\r\n        // Public variables and functions.\r\n\r\n        /**\r\n         * Initialise the module.\r\n         *\r\n         * @method init\r\n         * @return {PurposesActions}\r\n         */\r\n        'init': function() {\r\n            return new PurposesActions();\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","ACTIONS","PurposesActions","registerEvents","prototype","click","e","preventDefault","id","this","data","stringkeys","key","component","param","get_strings","then","langStrings","title","confirmMessage","buttonText","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","save","request","methodname","args","call","done","result","remove","addNotification","message","warnings","fail","exception","hidden","destroy","show"],"mappings":";;;;;;;AAsBAA,0CAAO,CACH,SACA,YACA,oBACA,WACA,qBACA,sBACJ,SAASC,EAAGC,KAAMC,aAAcC,IAAKC,aAAcC,iBAO3CC,eACQ,gCAMRC,gBAAkB,gBACbC,yBAMTD,gBAAgBE,UAAUD,eAAiB,WACvCR,EAAEM,gBAAgBI,OAAM,SAASC,GAC7BA,EAAEC,qBAEEC,GAAKb,EAAEc,MAAMC,KAAK,MAElBC,WAAa,CACb,CACIC,IAAK,gBACLC,UAAW,oBAEf,CACID,IAAK,oBACLC,UAAW,mBACXC,MATUnB,EAAEc,MAAMC,KAAK,SAW3B,CACIE,IAAK,WAIbd,IAAIiB,YAAYJ,YAAYK,MAAK,SAASC,iBAClCC,MAAQD,YAAY,GACpBE,eAAiBF,YAAY,GAC7BG,WAAaH,YAAY,UACtBlB,aAAasB,OAAO,CACvBH,MAAOA,MACPI,KAAMH,eACNI,KAAMxB,aAAayB,MAAMC,cAC1BT,MAAK,SAASU,cACbA,MAAMC,kBAAkBP,YAGxBM,MAAME,UAAUC,GAAG7B,YAAY8B,MAAM,eAE7BC,QAAU,CACVC,WAAY,kCACZC,KAAM,IAAOzB,KAGjBZ,KAAKsC,KAAK,CAACH,UAAU,GAAGI,MAAK,SAASzB,MAC9BA,KAAK0B,OACLzC,EAAE,sBAAwBa,GAAK,MAAM6B,SAErCxC,aAAayC,gBAAgB,CACzBC,QAAS7B,KAAK8B,SAAS,GAAGD,QAC1BhB,KAAM,aAGfkB,KAAK5C,aAAa6C,cAIzBhB,MAAME,UAAUC,GAAG7B,YAAY2C,QAAQ,WAEnCjB,MAAMkB,aAGHlB,YAEZS,MAAK,SAAST,OACbA,MAAMmB,UAEPJ,KAAK5C,aAAa6C,eAIgC,MASjD,kBACG,IAAIxC"}